<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>东方骄子</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://kangyonggan.com/"/>
  <updated>2019-03-28T05:01:14.901Z</updated>
  <id>http://kangyonggan.com/</id>
  
  <author>
    <name>康永敢</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Rabbitmq简记</title>
    <link href="http://kangyonggan.com/2019/03/28/Rabbitmq%E7%AE%80%E8%AE%B0/"/>
    <id>http://kangyonggan.com/2019/03/28/Rabbitmq简记/</id>
    <published>2019-03-28T05:00:49.000Z</published>
    <updated>2019-03-28T05:01:14.901Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 安装</span><br><span class="line">sudo apt-get install rabbitmq-server</span><br><span class="line"></span><br><span class="line"># 启动</span><br><span class="line">sudo rabbitmq-server start</span><br><span class="line"></span><br><span class="line"># 停止</span><br><span class="line">sudo rabbitmqctl stop</span><br><span class="line"></span><br><span class="line">## 状态</span><br><span class="line">sudo rabbitmqctl status</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="启用Web"><a href="#启用Web" class="headerlink" title="启用Web"></a>启用Web</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure><h2 id="访问Web"><a href="#访问Web" class="headerlink" title="访问Web"></a>访问Web</h2><p><a href="http://127.0.0.1:15672" target="_blank" rel="noopener">http://127.0.0.1:15672</a></p><p>guest/guest</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# 安装&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-get install rabbitmq-server&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 启动&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo rabbitmq-server start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 停止&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo rabbitmqctl stop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;## 状态&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo rabbitmqctl status&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="系统运维" scheme="http://kangyonggan.com/categories/%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Linux" scheme="http://kangyonggan.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot中swagger2的配置和使用</title>
    <link href="http://kangyonggan.com/2019/03/27/SpringBoot%E4%B8%ADswagger2%E7%9A%84%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <id>http://kangyonggan.com/2019/03/27/SpringBoot中swagger2的配置和使用/</id>
    <published>2019-03-27T09:41:34.000Z</published>
    <updated>2019-03-28T00:53:51.740Z</updated>
    
    <content type="html"><![CDATA[<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.3.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--swagger2--&gt;</span><br><span class="line">&lt;swagger.version&gt;2.9.2&lt;/swagger.version&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;!-- swagger --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;swagger.version&#125;&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;swagger.version&#125;&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  profiles:</span><br><span class="line">    active: @env@</span><br><span class="line">    </span><br><span class="line">app:</span><br><span class="line">  version: @project.version@</span><br></pre></td></tr></table></figure><h2 id="SwaggerConfigurer-java"><a href="#SwaggerConfigurer-java" class="headerlink" title="SwaggerConfigurer.java"></a>SwaggerConfigurer.java</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.configuration;</span><br><span class="line"></span><br><span class="line">import com.kangyonggan.demo.constants.AppConstants;</span><br><span class="line">import io.swagger.annotations.Api;</span><br><span class="line">import io.swagger.annotations.ApiOperation;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line">import springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line">import springfox.documentation.builders.ParameterBuilder;</span><br><span class="line">import springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line">import springfox.documentation.builders.ResponseMessageBuilder;</span><br><span class="line">import springfox.documentation.schema.ModelRef;</span><br><span class="line">import springfox.documentation.service.ApiInfo;</span><br><span class="line">import springfox.documentation.service.Contact;</span><br><span class="line">import springfox.documentation.service.Parameter;</span><br><span class="line">import springfox.documentation.service.ResponseMessage;</span><br><span class="line">import springfox.documentation.spi.DocumentationType;</span><br><span class="line">import springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line">import springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2019-03-27</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@EnableSwagger2</span><br><span class="line">public class SwaggerConfigurer &#123;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;app.version&#125;&quot;)</span><br><span class="line">    private String version;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;spring.profiles.active&#125;&quot;)</span><br><span class="line">    private String env;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Docket swaggerSpringMvcPlugin() &#123;</span><br><span class="line">        List&lt;ResponseMessage&gt; responseMessageList = new ArrayList&lt;&gt;();</span><br><span class="line">        responseMessageList.add(new ResponseMessageBuilder().code(404).message(&quot;资源不存在&quot;).build());</span><br><span class="line">        responseMessageList.add(new ResponseMessageBuilder().code(500).message(&quot;服务器内部错误&quot;).build());</span><br><span class="line"></span><br><span class="line">        ParameterBuilder token = new ParameterBuilder();</span><br><span class="line">        List&lt;Parameter&gt; parameters = new ArrayList&lt;&gt;();</span><br><span class="line">        token.name(AppConstants.HEADER_TOKEN_NAME).description(&quot;令牌&quot;).modelRef(new ModelRef(&quot;string&quot;)).parameterType(&quot;header&quot;).build();</span><br><span class="line">        parameters.add(token.build());</span><br><span class="line"></span><br><span class="line">        return new Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .enable(!&quot;prod&quot;.equals(env))</span><br><span class="line">                .globalResponseMessage(RequestMethod.GET, responseMessageList)</span><br><span class="line">                .globalResponseMessage(RequestMethod.POST, responseMessageList)</span><br><span class="line">                .globalResponseMessage(RequestMethod.PUT, responseMessageList)</span><br><span class="line">                .globalResponseMessage(RequestMethod.DELETE, responseMessageList)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .globalOperationParameters(parameters)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.withClassAnnotation(Api.class))</span><br><span class="line">                .apis(RequestHandlerSelectors.withMethodAnnotation(ApiOperation.class))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private ApiInfo apiInfo() &#123;</span><br><span class="line">        return new ApiInfoBuilder()</span><br><span class="line">                .title(&quot;后台接口文档&quot;)</span><br><span class="line">                .description(&quot;以下接口为前端开发者提供，如有疑问，请联系负责人，如下：&quot;)</span><br><span class="line">                .contact(new Contact(&quot;康永敢&quot;, &quot;https://kangyonggan.com&quot;, &quot;java@kangyonggan.com&quot;))</span><br><span class="line">                .version(version)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p><code>LoginController.java</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.controller;</span><br><span class="line"></span><br><span class="line">import com.kangyonggan.demo.constants.AppConstants;</span><br><span class="line">import com.kangyonggan.demo.dto.Response;</span><br><span class="line">import com.kangyonggan.demo.interceptor.ParamsInterceptor;</span><br><span class="line">import com.kangyonggan.demo.model.User;</span><br><span class="line">import com.kangyonggan.demo.service.UserService;</span><br><span class="line">import com.kangyonggan.demo.util.Digests;</span><br><span class="line">import com.kangyonggan.demo.util.Encodes;</span><br><span class="line">import io.swagger.annotations.Api;</span><br><span class="line">import io.swagger.annotations.ApiImplicitParam;</span><br><span class="line">import io.swagger.annotations.ApiImplicitParams;</span><br><span class="line">import io.swagger.annotations.ApiOperation;</span><br><span class="line">import lombok.extern.log4j.Log4j2;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 处理登录、登出相关请求</span><br><span class="line"> *</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2019-03-26</span><br><span class="line"> */</span><br><span class="line">@RestController</span><br><span class="line">@Log4j2</span><br><span class="line">@Api(tags = &quot;LoginController&quot;, description = &quot;登录相关接口&quot;)</span><br><span class="line">public class LoginController extends BaseController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private UserService userService;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 登录</span><br><span class="line">     *</span><br><span class="line">     * @param email</span><br><span class="line">     * @param password</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @PostMapping(&quot;login&quot;)</span><br><span class="line">    @ApiOperation(&quot;登录&quot;)</span><br><span class="line">    @ApiImplicitParams(&#123;</span><br><span class="line">            @ApiImplicitParam(name = &quot;email&quot;, value = &quot;电子邮箱&quot;, example = &quot;admin@kangyonggan.com&quot;),</span><br><span class="line">            @ApiImplicitParam(name = &quot;password&quot;, value = &quot;密码&quot;, example = &quot;11111111&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">    public Response login(@RequestParam String email, @RequestParam String password) &#123;</span><br><span class="line">        Response response = successResponse();</span><br><span class="line">        User user = userService.findUserByEmail(email);</span><br><span class="line">        if (user == null) &#123;</span><br><span class="line">            return response.failure(&quot;电子邮箱不存在&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (user.getIsDeleted() == 1) &#123;</span><br><span class="line">            return response.failure(&quot;电子邮箱已被锁定&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        byte[] salt = Encodes.decodeHex(user.getSalt());</span><br><span class="line">        byte[] hashPassword = Digests.sha1(password.getBytes(), salt, AppConstants.HASH_INTERATIONS);</span><br><span class="line">        String targetPassword = Encodes.encodeHex(hashPassword);</span><br><span class="line">        if (!user.getPassword().equals(targetPassword)) &#123;</span><br><span class="line">            log.error(&quot;密码错误, ip:&#123;&#125;, email:&#123;&#125;&quot;, getIpAddress(), email);</span><br><span class="line">            return response.failure(&quot;密码错误&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 把登录信息放入session</span><br><span class="line">        HttpSession session = ParamsInterceptor.getSession();</span><br><span class="line">        session.setAttribute(AppConstants.KEY_SESSION_USER, user);</span><br><span class="line">        log.info(&quot;登录成功,sessionId:&#123;&#125;&quot;, session.getId());</span><br><span class="line">        return response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 注销</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @GetMapping(&quot;logout&quot;)</span><br><span class="line">    @ApiOperation(&quot;登出&quot;)</span><br><span class="line">    public Response logout() &#123;</span><br><span class="line">        HttpSession session = ParamsInterceptor.getSession();</span><br><span class="line">        log.info(&quot;登出:&#123;&#125;&quot;, session.getAttribute(AppConstants.KEY_SESSION_USER));</span><br><span class="line">        session.removeAttribute(AppConstants.KEY_SESSION_USER);</span><br><span class="line">        return successResponse();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中<code>Response.java</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.dto;</span><br><span class="line"></span><br><span class="line">import com.kangyonggan.demo.constants.Resp;</span><br><span class="line">import io.swagger.annotations.ApiModel;</span><br><span class="line">import io.swagger.annotations.ApiModelProperty;</span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 通用响应</span><br><span class="line"> *</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 5/4/18</span><br><span class="line"> */</span><br><span class="line">@ApiModel(description = &quot;通用响应&quot;)</span><br><span class="line">@Data</span><br><span class="line">public class Response implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 响应码</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;响应码&quot;, required = true, example = &quot;0000&quot;)</span><br><span class="line">    private String respCo;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 响应消息</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;响应消息&quot;, required = true, example = &quot;操作成功&quot;)</span><br><span class="line">    private String respMsg;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 响应数据</span><br><span class="line">     */</span><br><span class="line">    @ApiModelProperty(value = &quot;响应数据&quot;, required = true)</span><br><span class="line">    private Map&lt;String, Object&gt; data = new HashMap&lt;&gt;(16);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 置为失败</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Response failure() &#123;</span><br><span class="line">        return failure(Resp.FAILURE.getRespCo(), Resp.FAILURE.getRespMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 置为失败</span><br><span class="line">     *</span><br><span class="line">     * @param respMsg</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Response failure(String respMsg) &#123;</span><br><span class="line">        return failure(Resp.FAILURE.getRespCo(), respMsg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 置为失败</span><br><span class="line">     *</span><br><span class="line">     * @param respCo</span><br><span class="line">     * @param respMsg</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Response failure(String respCo, String respMsg) &#123;</span><br><span class="line">        this.respCo = respCo;</span><br><span class="line">        this.respMsg = respMsg;</span><br><span class="line">        this.data.clear();</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * put</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Response put(String key, Object value) &#123;</span><br><span class="line">        if (data == null) &#123;</span><br><span class="line">            data = new HashMap&lt;&gt;(16);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        data.put(key, value);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="/uploads/swagger.png" alt="swagger"></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;依赖&quot;&gt;&lt;a href=&quot;#依赖&quot; class=&quot;headerlink&quot; title=&quot;依赖&quot;&gt;&lt;/a&gt;依赖&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;parent&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-parent&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;version&amp;gt;2.0.3.RELEASE&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;relativePath/&amp;gt; &amp;lt;!-- lookup parent from repository --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/parent&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;!--swagger2--&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;swagger.version&amp;gt;2.9.2&amp;lt;/swagger.version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;!-- swagger --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;io.springfox&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;springfox-swagger2&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;version&amp;gt;$&amp;#123;swagger.version&amp;#125;&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;io.springfox&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;springfox-swagger-ui&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;version&amp;gt;$&amp;#123;swagger.version&amp;#125;&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Java后台" scheme="http://kangyonggan.com/categories/Java%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="Java" scheme="http://kangyonggan.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot中redis-cache的配置和使用</title>
    <link href="http://kangyonggan.com/2019/03/27/SpringBoot%E4%B8%ADredis-cache%E7%9A%84%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <id>http://kangyonggan.com/2019/03/27/SpringBoot中redis-cache的配置和使用/</id>
    <published>2019-03-27T04:33:55.000Z</published>
    <updated>2019-03-27T04:46:31.957Z</updated>
    
    <content type="html"><![CDATA[<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;!--redis--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p><code>application.yml</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cache:</span><br><span class="line">    redis:</span><br><span class="line">      # 缓存有效期30分钟</span><br><span class="line">      time-to-live: 1800000</span><br><span class="line">  redis:</span><br><span class="line">    host: localhost</span><br><span class="line">    port: 6379</span><br><span class="line">    password: 123456</span><br></pre></td></tr></table></figure><p><code>RedisConfigurer.java</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.configuration;</span><br><span class="line"></span><br><span class="line">import org.springframework.cache.annotation.EnableCaching;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.data.redis.serializer.JdkSerializationRedisSerializer;</span><br><span class="line">import org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2019-03-26</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@EnableCaching</span><br><span class="line">public class RedisConfigurer &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    RedisTemplate redisTemplate(RedisConnectionFactory connectionFactory) &#123;</span><br><span class="line">        RedisTemplate redisTemplate = new RedisTemplate();</span><br><span class="line">        redisTemplate.setConnectionFactory(connectionFactory);</span><br><span class="line">        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        redisTemplate.setValueSerializer(new JdkSerializationRedisSerializer());</span><br><span class="line"></span><br><span class="line">        return redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.service.impl;</span><br><span class="line"></span><br><span class="line">import com.kangyonggan.demo.annotation.CacheDel;</span><br><span class="line">import com.kangyonggan.demo.model.User;</span><br><span class="line">import com.kangyonggan.demo.service.UserService;</span><br><span class="line">import org.springframework.cache.annotation.CacheConfig;</span><br><span class="line">import org.springframework.cache.annotation.CacheEvict;</span><br><span class="line">import org.springframework.cache.annotation.Cacheable;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 12/6/18</span><br><span class="line"> */</span><br><span class="line">@Service</span><br><span class="line">@CacheConfig(cacheNames = &quot;demo:user&quot;)</span><br><span class="line">public class UserServiceImpl extends BaseService&lt;User&gt; implements UserService &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 如果有缓存，则直接返回缓存，否则执行方法体，并缓存方法结果，其中key=&quot;demo:user::email:admin@kangyonggan.com&quot;</span><br><span class="line">     *</span><br><span class="line">     * @param email</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    @Cacheable(key = &quot;&apos;email:&apos; + #email&quot;)</span><br><span class="line">    public User findUserByEmail(String email) &#123;</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setEmail(email);</span><br><span class="line">        return myMapper.selectOne(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 如果有缓存，则直接返回缓存，否则执行方法体，并缓存方法结果，其中key=&quot;demo:user::all&quot;</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    @Cacheable(key = &quot;&apos;all&apos;&quot;)</span><br><span class="line">    public List&lt;User&gt; findAllUsers() &#123;</span><br><span class="line">        return myMapper.selectAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 清除缓存。key=&quot;demo:user::all&quot;</span><br><span class="line">     *</span><br><span class="line">     * @param user</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    @CacheEvict(key = &quot;&apos;all&apos;&quot;)</span><br><span class="line">    public void saveUser(User user) &#123;</span><br><span class="line">        myMapper.insertSelective(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 清除缓存。key=&quot;demo:user::all&quot;</span><br><span class="line">     * 清除缓存。key=&quot;demo:user::email:*&quot;</span><br><span class="line">     *</span><br><span class="line">     * @param user</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    @CacheEvict(key = &quot;&apos;all&apos;&quot;)</span><br><span class="line">    @CacheDel(&quot;demo:user::email:*&quot;)</span><br><span class="line">    public void updateUser(User user) &#123;</span><br><span class="line">        myMapper.updateByPrimaryKeySelective(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 清除缓存。key=&quot;demo:user::all&quot;</span><br><span class="line">     * 清除缓存。key=&quot;demo:user::email:*&quot;</span><br><span class="line">     *</span><br><span class="line">     * @param userId</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    @CacheEvict(key = &quot;&apos;all&apos;&quot;)</span><br><span class="line">    @CacheDel(&quot;demo:user::email:*&quot;)</span><br><span class="line">    public void deleteUser(Long userId) &#123;</span><br><span class="line">        myMapper.deleteByPrimaryKey(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="缓存注解AOP"><a href="#缓存注解AOP" class="headerlink" title="缓存注解AOP"></a>缓存注解AOP</h2><p>由于@CacheEvict并不支持模糊匹配，所以自定义了一个@CacheDel注解。</p><p><code>CacheDel.java</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.annotation;</span><br><span class="line"></span><br><span class="line">import java.lang.annotation.ElementType;</span><br><span class="line">import java.lang.annotation.Retention;</span><br><span class="line">import java.lang.annotation.RetentionPolicy;</span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 清除缓存，支持模糊匹配（*）</span><br><span class="line"> *</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2018/6/3 0003</span><br><span class="line"> */</span><br><span class="line">@Target(ElementType.METHOD)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface CacheDel &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 缓存的key。</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    String[] value();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>RedisCacheAop.java</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.aop;</span><br><span class="line"></span><br><span class="line">import com.kangyonggan.demo.annotation.CacheDel;</span><br><span class="line">import com.kangyonggan.demo.service.impl.RedisService;</span><br><span class="line">import org.aspectj.lang.JoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.Aspect;</span><br><span class="line">import org.aspectj.lang.annotation.Before;</span><br><span class="line">import org.aspectj.lang.annotation.Pointcut;</span><br><span class="line">import org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2019-03-26</span><br><span class="line"> */</span><br><span class="line">@Aspect</span><br><span class="line">@Configuration</span><br><span class="line">public class RedisCacheAop &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RedisService redisService;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 切入点</span><br><span class="line">     */</span><br><span class="line">    @Pointcut(&quot;execution(* com.kangyonggan.demo.service.*.*(..))&quot;)</span><br><span class="line">    public void pointCut() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 方法执行之前</span><br><span class="line">     *</span><br><span class="line">     * @param joinPoint</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Throwable</span><br><span class="line">     */</span><br><span class="line">    @Before(&quot;pointCut()&quot;)</span><br><span class="line">    public void before(JoinPoint joinPoint) throws Throwable &#123;</span><br><span class="line">        Class clazz = joinPoint.getTarget().getClass();</span><br><span class="line"></span><br><span class="line">        MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        Method method = clazz.getDeclaredMethod(methodSignature.getName(), methodSignature.getParameterTypes());</span><br><span class="line"></span><br><span class="line">        CacheDel cacheDel = method.getAnnotation(CacheDel.class);</span><br><span class="line">        if (cacheDel != null) &#123;</span><br><span class="line">            String[] keys = cacheDel.value();</span><br><span class="line">            for (String key : keys) &#123;</span><br><span class="line">                redisService.deleteAll(key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>RedisService.java</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.service.impl;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Set;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 8/14/18</span><br><span class="line"> */</span><br><span class="line">@Service</span><br><span class="line">public class RedisService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * set</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean set(String key, Object value) &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * set</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean set(String key, Object value, long timeout) &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value, timeout, TimeUnit.SECONDS);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * set</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @param timeout</span><br><span class="line">     * @param unit</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean set(String key, Object value, long timeout, TimeUnit unit) &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value, timeout, unit);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * get</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Object get(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * get</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param defaultValue</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Object get(String key, Object defaultValue) &#123;</span><br><span class="line">        Object val = redisTemplate.opsForValue().get(key);</span><br><span class="line"></span><br><span class="line">        return val == null ? defaultValue : val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * get and update expire</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @param timeout</span><br><span class="line">     * @param unit</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Object getAndUpdateExpire(String key, long timeout, TimeUnit unit) &#123;</span><br><span class="line">        Object object = redisTemplate.opsForValue().get(key);</span><br><span class="line">        if (object != null) &#123;</span><br><span class="line">            redisTemplate.expire(key, timeout, unit);</span><br><span class="line">        &#125;</span><br><span class="line">        return object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * multiGet</span><br><span class="line">     *</span><br><span class="line">     * @param keys</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List&lt;Object&gt; multiGet(Set&lt;String&gt; keys) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().multiGet(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * delete</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Object delete(String key) &#123;</span><br><span class="line">        Object object = redisTemplate.opsForValue().get(key);</span><br><span class="line">        if (object != null) &#123;</span><br><span class="line">            redisTemplate.delete(key);</span><br><span class="line">        &#125;</span><br><span class="line">        return object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * delete all like pattern</span><br><span class="line">     *</span><br><span class="line">     * @param pattern</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public void deleteAll(String pattern) &#123;</span><br><span class="line">        redisTemplate.delete(redisTemplate.keys(pattern));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * incr</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public long incr(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForValue().increment(key, 1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public long leftPush(String key, Object value) &#123;</span><br><span class="line">        return redisTemplate.opsForList().leftPush(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param key</span><br><span class="line">     * @param values</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public long leftPushAll(String key, Object... values) &#123;</span><br><span class="line">        return redisTemplate.opsForList().leftPushAll(key, values);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Object rightPop(String key) &#123;</span><br><span class="line">        return redisTemplate.opsForList().rightPop(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * listRange</span><br><span class="line">     *</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List&lt;Object&gt; listRange(String key, long start, long end) &#123;</span><br><span class="line">        return redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * hashSetNx</span><br><span class="line">     *</span><br><span class="line">     * @param hash</span><br><span class="line">     * @param key</span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean hashSetNx(String hash, String key, String value) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().putIfAbsent(hash, key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * hashSize</span><br><span class="line">     *</span><br><span class="line">     * @param hash</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public long hashSize(String hash) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().size(hash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * hashExist</span><br><span class="line">     *</span><br><span class="line">     * @param hash</span><br><span class="line">     * @param key</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean hashExist(String hash, String key) &#123;</span><br><span class="line">        return redisTemplate.opsForHash().hasKey(hash, key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * get keys of pattern</span><br><span class="line">     *</span><br><span class="line">     * @param pattern</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;String&gt; getKeys(String pattern) &#123;</span><br><span class="line">        return redisTemplate.keys(pattern);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;依赖&quot;&gt;&lt;a href=&quot;#依赖&quot; class=&quot;headerlink&quot; title=&quot;依赖&quot;&gt;&lt;/a&gt;依赖&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;parent&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-parent&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;version&amp;gt;2.1.3.RELEASE&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;relativePath/&amp;gt; &amp;lt;!-- lookup parent from repository --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/parent&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;!--redis--&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-data-redis&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-cache&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;redis.clients&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;jedis&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Java后台" scheme="http://kangyonggan.com/categories/Java%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="Java" scheme="http://kangyonggan.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot中log4j2.yml的配置和使用</title>
    <link href="http://kangyonggan.com/2019/03/27/SpringBoot%E4%B8%ADlog4j2.yml%E7%9A%84%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <id>http://kangyonggan.com/2019/03/27/SpringBoot中log4j2.yml的配置和使用/</id>
    <published>2019-03-27T02:19:06.000Z</published>
    <updated>2019-03-27T02:29:29.924Z</updated>
    
    <content type="html"><![CDATA[<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.3.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;!--log4j2 yml--&gt;</span><br><span class="line">&lt;jackson-dataformat-yaml.version&gt;2.9.8&lt;/jackson-dataformat-yaml.version&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;!--log4j2 yml--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-dataformat-yaml&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;jackson-dataformat-yaml.version&#125;&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="log4j2-yml"><a href="#log4j2-yml" class="headerlink" title="log4j2.yml"></a>log4j2.yml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">Configuration:</span><br><span class="line">  status: warn</span><br><span class="line">  monitorInterval: 300</span><br><span class="line"></span><br><span class="line">  properties:</span><br><span class="line">    property:</span><br><span class="line">      - name: pattern</span><br><span class="line">        value: &quot;[%-5level] %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%logger&#123;36&#125;.%t:%L] - %msg%n&quot;</span><br><span class="line">      - name: path</span><br><span class="line">        value: /Users/kyg/logs/demo</span><br><span class="line"></span><br><span class="line">  Appenders:</span><br><span class="line">    RollingFile:</span><br><span class="line">      - name: AllFile</span><br><span class="line">        fileName: $&#123;path&#125;/all.log</span><br><span class="line">        filePattern: &quot;$&#123;path&#125;/archive/$$&#123;date:yyyy-MM&#125;/all-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;</span><br><span class="line">        PatternLayout:</span><br><span class="line">          pattern: $&#123;pattern&#125;</span><br><span class="line">        Filters:</span><br><span class="line">          ThresholdFilter:</span><br><span class="line">            - level: fatal</span><br><span class="line">              onMatch: DENY</span><br><span class="line">              onMismatch: NEUTRAL</span><br><span class="line">            - level: debug</span><br><span class="line">              onMatch: ACCEPT</span><br><span class="line">              onMismatch: DENY</span><br><span class="line">        Policies:</span><br><span class="line">          TimeBasedTriggeringPolicy:</span><br><span class="line">            interval: 1</span><br><span class="line">          SizeBasedTriggeringPolicy:</span><br><span class="line">            size: &quot;500 MB&quot;</span><br><span class="line">        DefaultRolloverStrategy:</span><br><span class="line">          max: 200</span><br><span class="line"></span><br><span class="line">      - name: ErrorFile</span><br><span class="line">        fileName: $&#123;path&#125;/error.log</span><br><span class="line">        filePattern: &quot;$&#123;path&#125;/archive/$$&#123;date:yyyy-MM&#125;/error-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;</span><br><span class="line">        PatternLayout:</span><br><span class="line">          pattern: $&#123;pattern&#125;</span><br><span class="line">        Filters:</span><br><span class="line">          ThresholdFilter:</span><br><span class="line">            - level: fatal</span><br><span class="line">              onMatch: DENY</span><br><span class="line">              onMismatch: NEUTRAL</span><br><span class="line">            - level: error</span><br><span class="line">              onMatch: ACCEPT</span><br><span class="line">              onMismatch: DENY</span><br><span class="line">        Policies:</span><br><span class="line">          TimeBasedTriggeringPolicy:</span><br><span class="line">            interval: 1</span><br><span class="line">          SizeBasedTriggeringPolicy:</span><br><span class="line">            size: &quot;500 MB&quot;</span><br><span class="line">          DefaultRolloverStrategy:</span><br><span class="line">            max: 200</span><br><span class="line"></span><br><span class="line">  Loggers:</span><br><span class="line">    Logger:</span><br><span class="line">      name: com.kangyonggan.demo.mapper</span><br><span class="line">      level: debug</span><br><span class="line">      additivity: false</span><br><span class="line">      AppenderRef:</span><br><span class="line">        - ref: AllFile</span><br><span class="line">        - ref: ErrorFile</span><br><span class="line"></span><br><span class="line">    Root:</span><br><span class="line">      level: info</span><br><span class="line">      additivity: true</span><br><span class="line">      AppenderRef:</span><br><span class="line">        - ref: AllFile</span><br><span class="line">        - ref: ErrorFile</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;依赖&quot;&gt;&lt;a href=&quot;#依赖&quot; class=&quot;headerlink&quot; title=&quot;依赖&quot;&gt;&lt;/a&gt;依赖&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;parent&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-parent&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;version&amp;gt;2.0.3.RELEASE&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;relativePath/&amp;gt; &amp;lt;!-- lookup parent from repository --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/parent&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;!--log4j2 yml--&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;jackson-dataformat-yaml.version&amp;gt;2.9.8&amp;lt;/jackson-dataformat-yaml.version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;!--log4j2 yml--&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-log4j2&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;com.fasterxml.jackson.dataformat&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;jackson-dataformat-yaml&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;version&amp;gt;$&amp;#123;jackson-dataformat-yaml.version&amp;#125;&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Java后台" scheme="http://kangyonggan.com/categories/Java%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="Java" scheme="http://kangyonggan.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Redis简记</title>
    <link href="http://kangyonggan.com/2019/03/26/Redis%E7%AE%80%E8%AE%B0/"/>
    <id>http://kangyonggan.com/2019/03/26/Redis简记/</id>
    <published>2019-03-26T10:56:54.000Z</published>
    <updated>2019-03-26T11:00:57.166Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Redis简记"><a href="#Redis简记" class="headerlink" title="Redis简记"></a>Redis简记</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 下载</span><br><span class="line">wget http://download.redis.io/releases/redis-5.0.3.tar.gz</span><br><span class="line"># 解压</span><br><span class="line">tar -zxvf redis-5.0.3.tar.gz -C ../install/</span><br><span class="line"># 编译</span><br><span class="line">cd src/</span><br><span class="line">sudo make &amp; sudo make install</span><br></pre></td></tr></table></figure><a id="more"></a><p>如果没安装make</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install make</span><br></pre></td></tr></table></figure><p>如果没安装gcc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gcc</span><br></pre></td></tr></table></figure><p>如果报错：jemalloc/jemalloc.h: No such file or directory</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make MALLOC=libc</span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis.conf &amp;</span><br></pre></td></tr></table></figure><h2 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 123456 shutdown</span><br></pre></td></tr></table></figure><h2 id="集群（小哨兵）"><a href="#集群（小哨兵）" class="headerlink" title="集群（小哨兵）"></a>集群（小哨兵）</h2><h3 id="master"><a href="#master" class="headerlink" title="master"></a>master</h3><p>配置主库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># vi redis.conf</span><br><span class="line"># bind 127.0.0.1</span><br><span class="line">requirepass &quot;123456&quot;</span><br><span class="line">masterauth &quot;123456&quot;</span><br></pre></td></tr></table></figure><p>启动主库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis.conf &amp;</span><br><span class="line"># 登录</span><br><span class="line">redis-cli -a 123456</span><br><span class="line"># 查看信息</span><br><span class="line">INFO</span><br></pre></td></tr></table></figure><h3 id="sentinel"><a href="#sentinel" class="headerlink" title="sentinel"></a>sentinel</h3><p>配置哨兵</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># vi sentinel.conf</span><br><span class="line">sentinel monitor mymaster 192.168.0.100 6379 2</span><br><span class="line">sentinel auth-pass mymaster 123456</span><br></pre></td></tr></table></figure><p>参数2表示：只要sentinel集群中有2个认为master无法连接之后，就会进行主从切换。</p><p>启动哨兵</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-sentinel sentinel.conf &amp;</span><br></pre></td></tr></table></figure><h3 id="slave"><a href="#slave" class="headerlink" title="slave"></a>slave</h3><p>配置从库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># vi redis.conf</span><br><span class="line"># bind 127.0.0.1</span><br><span class="line">requirepass &quot;123456&quot;</span><br><span class="line">replicaof 192.168.0.100 6379</span><br><span class="line">masterauth &quot;123456&quot;</span><br></pre></td></tr></table></figure><p>启动从库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis.conf &amp;</span><br><span class="line"># 登录</span><br><span class="line">redis-cli -a 123456</span><br><span class="line"># 查看信息</span><br><span class="line">INFO</span><br></pre></td></tr></table></figure></p><h3 id="sentinel-1"><a href="#sentinel-1" class="headerlink" title="sentinel"></a>sentinel</h3><p>配置哨兵</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># vi sentinel.conf</span><br><span class="line">sentinel monitor mymaster 192.168.0.100 6379 2</span><br><span class="line">sentinel auth-pass mymaster 123456</span><br></pre></td></tr></table></figure><p>启动哨兵</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-sentinel sentinel.conf &amp;</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>如果想弄清楚小哨兵的工作模式，必须亲手测试，比如杀死主库等。</p><h2 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>1.application.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  redis:</span><br><span class="line">    host: localhost</span><br><span class="line">    port: 6379</span><br><span class="line">    password: 123456</span><br><span class="line">    sentinel:</span><br><span class="line">      master: mymaster</span><br><span class="line">      nodes: localhost:26379</span><br></pre></td></tr></table></figure></p><p>2.RedisConfigurer.java</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.configuration;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.data.redis.serializer.JdkSerializationRedisSerializer;</span><br><span class="line">import org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2019-03-26</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class RedisConfigurer &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    RedisTemplate redisTemplate(RedisConnectionFactory connectionFactory) &#123;</span><br><span class="line">        RedisTemplate redisTemplate = new RedisTemplate();</span><br><span class="line">        redisTemplate.setConnectionFactory(connectionFactory);</span><br><span class="line">        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        redisTemplate.setValueSerializer(new JdkSerializationRedisSerializer());</span><br><span class="line"></span><br><span class="line">        return redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Redis简记&quot;&gt;&lt;a href=&quot;#Redis简记&quot; class=&quot;headerlink&quot; title=&quot;Redis简记&quot;&gt;&lt;/a&gt;Redis简记&lt;/h1&gt;&lt;h2 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# 下载&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget http://download.redis.io/releases/redis-5.0.3.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 解压&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf redis-5.0.3.tar.gz -C ../install/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 编译&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd src/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo make &amp;amp; sudo make install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="系统运维" scheme="http://kangyonggan.com/categories/%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Linux" scheme="http://kangyonggan.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Nexus简记</title>
    <link href="http://kangyonggan.com/2019/03/26/Nexus%E7%AE%80%E8%AE%B0/"/>
    <id>http://kangyonggan.com/2019/03/26/Nexus简记/</id>
    <published>2019-03-26T10:55:24.000Z</published>
    <updated>2019-03-26T10:56:15.960Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">下载</span><br><span class="line">wget https://sonatype-download.global.ssl.fastly.net/repository/repositoryManager/3/nexus-3.15.2-01-unix.tar.gz</span><br><span class="line"># 解压</span><br><span class="line">tar -zxvf nexus-3.15.2-01-unix.tar.gz -C ../install/</span><br><span class="line"># 启动</span><br><span class="line">./nexus start</span><br><span class="line"># 停止</span><br><span class="line">./nexus stop</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p>由于nexus安装在内网服务器上，外网无法访问，所以需要使用反向代理，配置如下：</p><h3 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -C -f -N -g -R 8881:127.0.0.1:8081 root@kangyonggan.com</span><br></pre></td></tr></table></figure><h3 id="外网nginx的配置"><a href="#外网nginx的配置" class="headerlink" title="外网nginx的配置"></a>外网nginx的配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># nexus</span><br><span class="line">server &#123;</span><br><span class="line">        listen 8081;</span><br><span class="line">client_max_body_size 50m;</span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_set_header Host www.kangyonggan.com:8081;</span><br><span class="line">                proxy_pass http://localhost:8881;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="外网访问"><a href="#外网访问" class="headerlink" title="外网访问"></a>外网访问</h2><p><a href="http://kangyonggan.com:8081">http://kangyonggan.com:8081</a><br>admin/admin123</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="settings-xml"><a href="#settings-xml" class="headerlink" title="settings.xml"></a>settings.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;servers&gt;</span><br><span class="line">    &lt;server&gt;</span><br><span class="line">      &lt;id&gt;releases&lt;/id&gt;</span><br><span class="line">      &lt;username&gt;admin&lt;/username&gt;</span><br><span class="line">      &lt;password&gt;admin123&lt;/password&gt;</span><br><span class="line">    &lt;/server&gt;</span><br><span class="line">    &lt;server&gt;</span><br><span class="line">      &lt;id&gt;snapshots&lt;/id&gt;</span><br><span class="line">      &lt;username&gt;admin&lt;/username&gt;</span><br><span class="line">      &lt;password&gt;admin123&lt;/password&gt;</span><br><span class="line">    &lt;/server&gt;</span><br><span class="line">  &lt;/servers&gt;</span><br></pre></td></tr></table></figure><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;distributionManagement&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">        &lt;id&gt;releases&lt;/id&gt;</span><br><span class="line">        &lt;name&gt;nexus releases&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;http://kangyonggan.com:8081/repository/maven-releases/&lt;/url&gt;</span><br><span class="line">    &lt;/repository&gt;</span><br><span class="line"></span><br><span class="line">    &lt;snapshotRepository&gt;</span><br><span class="line">        &lt;id&gt;snapshots&lt;/id&gt;</span><br><span class="line">        &lt;name&gt;nexus snapshots&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;http://kangyonggan.com:8081/repository/maven-snapshots/&lt;/url&gt;</span><br><span class="line">    &lt;/snapshotRepository&gt;</span><br><span class="line">&lt;/distributionManagement&gt;</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn deploy</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552886026067-4e52b799-922e-47b6-be18-32d06cd75ccb.png#align=left&amp;display=inline&amp;height=993&amp;name=image.png&amp;originHeight=993&amp;originWidth=1680&amp;size=83598&amp;status=done&amp;width=1680" alt="image.png"><br></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;下载&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget https://sonatype-download.global.ssl.fastly.net/repository/repositoryManager/3/nexus-3.15.2-01-unix.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 解压&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf nexus-3.15.2-01-unix.tar.gz -C ../install/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 启动&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./nexus start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 停止&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./nexus stop&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="系统运维" scheme="http://kangyonggan.com/categories/%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Linux" scheme="http://kangyonggan.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>GitLab简记</title>
    <link href="http://kangyonggan.com/2019/03/26/GitLab%E7%AE%80%E8%AE%B0/"/>
    <id>http://kangyonggan.com/2019/03/26/GitLab简记/</id>
    <published>2019-03-26T10:44:45.000Z</published>
    <updated>2019-03-26T10:54:44.675Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><blockquote><p>Ubuntu 16.04.6 LTS</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 查看端口占用情况，kill掉占用80的进程，否则会502</span><br><span class="line">netstat -anptl</span><br><span class="line"></span><br><span class="line">sudo apt-get install curl openssh-server ca-certificates postfix</span><br><span class="line">curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash</span><br><span class="line">sudo apt-get install gitlab-ce</span><br><span class="line"></span><br><span class="line">sudo gitlab-ctl reconfigure</span><br><span class="line">sudo gitlab-ctl status</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p>由于gitlab安装在内网服务器上，外网无法访问，所以需要使用反向代理，配置如下：</p><h3 id="内网GitLab的配置"><a href="#内网GitLab的配置" class="headerlink" title="内网GitLab的配置"></a>内网GitLab的配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/gitlab/gitlab.rb</span><br></pre></td></tr></table></figure><ol><li>修改GitLab的url</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">external_url &apos;http://kangyonggan.com:8888&apos;</span><br></pre></td></tr></table></figure><ol><li>修改监听的端口</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx[&apos;listen_port&apos;] = 8888</span><br></pre></td></tr></table></figure><h3 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -C -f -N -g -R 8880:127.0.0.1:8888 root@kangyonggan.com</span><br></pre></td></tr></table></figure><h3 id="外网Nginx的配置"><a href="#外网Nginx的配置" class="headerlink" title="外网Nginx的配置"></a>外网Nginx的配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/nginx/sites-available/default</span><br></pre></td></tr></table></figure><p>增加配置如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># gitlab</span><br><span class="line">server &#123;</span><br><span class="line">        listen 8888;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://localhost:8880;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="情景"><a href="#情景" class="headerlink" title="情景"></a>情景</h2><p>假设公司有3个小组，分别为：</p><ul><li>网关组</li><li>风控组</li></ul><p>各小组成员分别为：</p><ul><li>网关组：张大（组长）、张二、张三。</li><li>风控组：李大（组长）、李二、李三、李四。</li></ul><p>各小组项目分别为：</p><ul><li>网关组：proj1、proj2。</li><li>风控组：proj3、proj4。</li></ul><h2 id="管理员"><a href="#管理员" class="headerlink" title="管理员"></a>管理员</h2><p>使用管理员（root）登录之后，找到管理员区域（Admin Area）。</p><h3 id="添加组"><a href="#添加组" class="headerlink" title="添加组"></a>添加组</h3><p><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552789465544-f1abe8bd-2286-4fd7-bd9e-500c91c9832f.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-01.png&amp;originHeight=969&amp;originWidth=1920&amp;size=45632&amp;status=done&amp;width=746" alt="gitlab-01.png"></p><h4 id="New-Group"><a href="#New-Group" class="headerlink" title="New Group"></a>New Group</h4><p><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552789573991-47f3ccdd-5c46-4923-8724-0c55ad026431.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-02.png&amp;originHeight=969&amp;originWidth=1920&amp;size=80829&amp;status=done&amp;width=746" alt="gitlab-02.png"><br><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552789580543-fad3d07f-8ce2-4fb2-9c87-1043410536bb.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-03.png&amp;originHeight=969&amp;originWidth=1920&amp;size=57904&amp;status=done&amp;width=746" alt="gitlab-03.png"></p><h3 id="禁用注册"><a href="#禁用注册" class="headerlink" title="禁用注册"></a>禁用注册</h3><p>如果开放注册，到时候将会看见五花大门的用户名和邮箱地址，为了统一，当有新人到来时统一分配。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552789697811-2337a312-93bb-4e40-a6ac-8d290c2c2038.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-04.png&amp;originHeight=969&amp;originWidth=1920&amp;size=77542&amp;status=done&amp;width=746" alt="gitlab-04.png"><br>退出登录后将会发现没有注册界面了<br><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552789939832-d179361a-ba45-4a7e-a70c-565c1481abb5.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-07.png&amp;originHeight=969&amp;originWidth=1920&amp;size=39467&amp;status=done&amp;width=746" alt="gitlab-07.png"><br></p><h3 id="添加成员"><a href="#添加成员" class="headerlink" title="添加成员"></a>添加成员</h3><p><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552789825007-2c213c8b-fe1c-4231-99e4-b9120bf30e84.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-05.png&amp;originHeight=969&amp;originWidth=1920&amp;size=58200&amp;status=done&amp;width=746" alt="gitlab-05.png"><br><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552789834676-f8bff8a2-6ef0-44e3-9b6f-f2afafb48446.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-06.png&amp;originHeight=969&amp;originWidth=1920&amp;size=67307&amp;status=done&amp;width=746" alt="gitlab-06.png"><br>注意：组长允许创建项目，但不允许创建组。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552791029245-2ece65ce-916b-4a43-a20a-6a66fef62a60.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-14.png&amp;originHeight=969&amp;originWidth=1920&amp;size=61319&amp;status=done&amp;width=746" alt="gitlab-14.png"><br>普通成员既不允许创建项目，也不允许创建组。</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552790133361-d308ca8a-c825-4ef2-86ee-d2c6d70b9674.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-08.png&amp;originHeight=969&amp;originWidth=1920&amp;size=92158&amp;status=done&amp;width=746" alt="gitlab-08.png"></p><p>如果用户收不到重置密码的邮件，管理员可以对用户进行编辑，在编辑页修改密码<br><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552790643288-df061888-af22-49fb-a7d5-0a57ceb3e663.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-12.png&amp;originHeight=969&amp;originWidth=1920&amp;size=62152&amp;status=done&amp;width=746" alt="gitlab-12.png"><br></p><h3 id="分配用户到组"><a href="#分配用户到组" class="headerlink" title="分配用户到组"></a>分配用户到组</h3><p><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552790325799-33334f9d-370a-48a1-8ce7-eab6039dda36.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-09.png&amp;originHeight=969&amp;originWidth=1920&amp;size=83202&amp;status=done&amp;width=746" alt="gitlab-09.png"><br><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552790331815-9b1c2840-abb3-4eff-962d-099a862b2ed3.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-10.png&amp;originHeight=969&amp;originWidth=1920&amp;size=92619&amp;status=done&amp;width=746" alt="gitlab-10.png"><br><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552790402190-7a0368ac-767c-4173-a2f9-65223197ab19.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-11.png&amp;originHeight=969&amp;originWidth=1920&amp;size=98381&amp;status=done&amp;width=746" alt="gitlab-11.png"></p><h2 id="组长"><a href="#组长" class="headerlink" title="组长"></a>组长</h2><p>首次登录会要求修改密码<br><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552790840742-0ea38e2e-24a7-4623-b971-00585bc6691a.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-13.png&amp;originHeight=969&amp;originWidth=1920&amp;size=35709&amp;status=done&amp;width=746" alt="gitlab-13.png"></p><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552791334980-830f5bf9-1eca-4a3a-9229-8868542078d2.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-16.png&amp;originHeight=969&amp;originWidth=1920&amp;size=76871&amp;status=done&amp;width=746" alt="gitlab-16.png"><br><img src="https://cdn.nlark.com/yuque/0/2019/png/159622/1552791335381-60b53863-9b0c-49a0-90c4-13b4fc573676.png#align=left&amp;display=inline&amp;height=376&amp;name=gitlab-17.png&amp;originHeight=969&amp;originWidth=1920&amp;size=79542&amp;status=done&amp;width=746" alt="gitlab-17.png"></p><p>说明：developer角色不能push代码到master分支，通常master分支可以作为生产分支，仅组长可以push，开发者可以在其他分支开发，最后由组长合并代码到master分支。</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Ubuntu 16.04.6 LTS&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# 查看端口占用情况，kill掉占用80的进程，否则会502&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;netstat -anptl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-get install curl openssh-server ca-certificates postfix&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-get install gitlab-ce&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo gitlab-ctl reconfigure&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo gitlab-ctl status&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="系统运维" scheme="http://kangyonggan.com/categories/%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="Linux" scheme="http://kangyonggan.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot中RedisSession的使用</title>
    <link href="http://kangyonggan.com/2019/03/26/SpringBoot%E4%B8%ADRedisSession%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://kangyonggan.com/2019/03/26/SpringBoot中RedisSession的使用/</id>
    <published>2019-03-26T07:37:08.000Z</published>
    <updated>2019-03-28T00:53:08.941Z</updated>
    
    <content type="html"><![CDATA[<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.3.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;spring-session-data-redis.version&gt;2.1.3.RELEASE&lt;/spring-session-data-redis.version&gt;</span><br><span class="line">&lt;spring-session.version&gt;1.3.5.RELEASE&lt;/spring-session.version&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;!--spring--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--redis session--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;spring-session-data-redis.version&#125;&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-session&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;spring-session.version&#125;&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p><code>HttpSessionConfigurer.java</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.configuration;</span><br><span class="line"></span><br><span class="line">import com.kangyonggan.demo.constants.AppConstants;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.session.data.redis.config.annotation.web.http.EnableRedisHttpSession;</span><br><span class="line">import org.springframework.session.web.http.HeaderHttpSessionIdResolver;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2019/3/27 0027</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@EnableRedisHttpSession(redisNamespace = &quot;demo:session&quot;)</span><br><span class="line">public class HttpSessionConfigurer &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * token放在http请求的header中，name=X-Auth-Token</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public HeaderHttpSessionIdResolver httpSessionStrategy() &#123;</span><br><span class="line">        return new HeaderHttpSessionIdResolver(AppConstants.HEADER_TOKEN_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中<code>@EnableRedisHttpSession</code>注解用于启用redis session。</p><h2 id="登录认证"><a href="#登录认证" class="headerlink" title="登录认证"></a>登录认证</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 判断是否登录</span><br><span class="line"> *</span><br><span class="line"> * @param response</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">private boolean isLogin(HttpServletResponse response) &#123;</span><br><span class="line">    // 判断是否登录</span><br><span class="line">    if (!ParamsInterceptor.getSession().getId().equals(ParamsInterceptor.getToken())) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 获取token</span><br><span class="line"> *</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public static String getToken() &#123;</span><br><span class="line">    return currentRequest.get().getHeader(AppConstants.HEADER_TOKEN_NAME);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;依赖&quot;&gt;&lt;a href=&quot;#依赖&quot; class=&quot;headerlink&quot; title=&quot;依赖&quot;&gt;&lt;/a&gt;依赖&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;parent&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-parent&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;version&amp;gt;2.0.3.RELEASE&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;relativePath/&amp;gt; &amp;lt;!-- lookup parent from repository --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/parent&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;spring-session-data-redis.version&amp;gt;2.1.3.RELEASE&amp;lt;/spring-session-data-redis.version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;spring-session.version&amp;gt;1.3.5.RELEASE&amp;lt;/spring-session.version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;!--spring--&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-test&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;!--redis session--&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-data-redis&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.session&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-session-data-redis&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;version&amp;gt;$&amp;#123;spring-session-data-redis.version&amp;#125;&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.session&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-session&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;version&amp;gt;$&amp;#123;spring-session.version&amp;#125;&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Java后台" scheme="http://kangyonggan.com/categories/Java%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="Java" scheme="http://kangyonggan.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot中Aop的使用</title>
    <link href="http://kangyonggan.com/2019/03/26/SpringBoot%E4%B8%ADAop%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://kangyonggan.com/2019/03/26/SpringBoot中Aop的使用/</id>
    <published>2019-03-26T07:32:21.000Z</published>
    <updated>2019-03-26T07:36:11.188Z</updated>
    
    <content type="html"><![CDATA[<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.3.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;!--spring--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="打印方法出入参"><a href="#打印方法出入参" class="headerlink" title="打印方法出入参"></a>打印方法出入参</h2><p><code>MethodLogAop.java</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.aop;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.kangyonggan.demo.annotation.MethodLog;</span><br><span class="line">import lombok.extern.log4j.Log4j2;</span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.Around;</span><br><span class="line">import org.aspectj.lang.annotation.Aspect;</span><br><span class="line">import org.aspectj.lang.annotation.Pointcut;</span><br><span class="line">import org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2019-03-26</span><br><span class="line"> */</span><br><span class="line">@Aspect</span><br><span class="line">@Configuration</span><br><span class="line">@Log4j2</span><br><span class="line">public class MethodLogAop &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 切入点</span><br><span class="line">     */</span><br><span class="line">    @Pointcut(&quot;execution(* com.kangyonggan.demo.service.*.*(..))&quot;)</span><br><span class="line">    public void pointCut() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 环绕方法</span><br><span class="line">     *</span><br><span class="line">     * @param joinPoint</span><br><span class="line">     * @return</span><br><span class="line">     * @throws Throwable</span><br><span class="line">     */</span><br><span class="line">    @Around(&quot;pointCut()&quot;)</span><br><span class="line">    public Object around(ProceedingJoinPoint joinPoint) throws Throwable &#123;</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        Class clazz = joinPoint.getTarget().getClass();</span><br><span class="line"></span><br><span class="line">        MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        Method method = clazz.getDeclaredMethod(methodSignature.getName(), methodSignature.getParameterTypes());</span><br><span class="line">        String targetName = &quot;[&quot; + clazz.getName() + &quot;.&quot; + method.getName() + &quot;]&quot;;</span><br><span class="line"></span><br><span class="line">        MethodLog methodLog = method.getAnnotation(MethodLog.class);</span><br><span class="line">        Object result;</span><br><span class="line">        if (methodLog != null) &#123;</span><br><span class="line">            log.info(&quot;进入方法:&#123;&#125; - args: &#123;&#125;&quot;, targetName, JSON.toJSONString(args));</span><br><span class="line"></span><br><span class="line">            long beginTime = System.currentTimeMillis();</span><br><span class="line">            result = joinPoint.proceed(args);</span><br><span class="line">            long endTime = System.currentTimeMillis();</span><br><span class="line">            long time = endTime - beginTime;</span><br><span class="line"></span><br><span class="line">            log.info(&quot;离开方法:&#123;&#125; - return: &#123;&#125;&quot;, targetName, JSON.toJSONString(result));</span><br><span class="line">            log.info(&quot;方法耗时:&#123;&#125;ms - &#123;&#125;&quot;, time, targetName);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            result = joinPoint.proceed(args);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中<code>MethodLog.java</code>: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.annotation;</span><br><span class="line"></span><br><span class="line">import java.lang.annotation.ElementType;</span><br><span class="line">import java.lang.annotation.Retention;</span><br><span class="line">import java.lang.annotation.RetentionPolicy;</span><br><span class="line">import java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 方法日志。打印出参、入参和执行时间</span><br><span class="line"> *</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2018/6/3 0003</span><br><span class="line"> */</span><br><span class="line">@Target(ElementType.METHOD)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface MethodLog &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;依赖&quot;&gt;&lt;a href=&quot;#依赖&quot; class=&quot;headerlink&quot; title=&quot;依赖&quot;&gt;&lt;/a&gt;依赖&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;parent&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-parent&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;version&amp;gt;2.0.3.RELEASE&amp;lt;/version&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;relativePath/&amp;gt; &amp;lt;!-- lookup parent from repository --&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/parent&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;!--spring--&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-test&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;spring-boot-starter-aop&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;groupId&amp;gt;org.aspectj&amp;lt;/groupId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;artifactId&amp;gt;aspectjweaver&amp;lt;/artifactId&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Java后台" scheme="http://kangyonggan.com/categories/Java%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="Java" scheme="http://kangyonggan.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>手写简易版rpc框架</title>
    <link href="http://kangyonggan.com/2019/02/21/%E6%89%8B%E5%86%99%E7%AE%80%E6%98%93%E7%89%88rpc%E6%A1%86%E6%9E%B6/"/>
    <id>http://kangyonggan.com/2019/02/21/手写简易版rpc框架/</id>
    <published>2019-02-21T01:55:40.000Z</published>
    <updated>2019-02-21T01:56:26.764Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>RPC（Remote Procedure Call）远程过程调用。本例为简易版rpc框架，实现功能与dubbo类似。</p><h2 id="RPC主调用过程"><a href="#RPC主调用过程" class="headerlink" title="RPC主调用过程"></a>RPC主调用过程</h2><p><img src="https://kangyonggan.com/upload/blog/rpc.png" alt=""></p><blockquote><p>Provioder：服务提供者<br>Register：注册中心<br>Consumer：服务消费者</p></blockquote><p>当然，这只是其中一个维度的主过程，其中还有很多花里胡哨的细节，诸如负载均衡、泛华调用、服务降级等功能。待我打通主线任务后再慢慢添加支线任务。</p><a id="more"></a><h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p><a href="https://github.com/kangyonggan/rpc.git" target="_blank" rel="noopener">https://github.com/kangyonggan/rpc.git</a></p><h3 id="分支说明"><a href="#分支说明" class="headerlink" title="分支说明"></a>分支说明</h3><ul><li>master： 完整代码。</li><li>01-xsd：自定义xml标签</li><li>02-start-server：启动服务端</li><li>03-register-service：发布服务</li><li>04-subscribe-service：获取服务</li><li>05-remote-call：远程调用</li><li>06-load-balance：负载均衡</li><li>07-point2point：点对点服务</li><li>08-version：服务版本控制</li><li>09-timeout：超时时间</li><li>10-cache：结果缓存</li><li>11-async：异步调用</li><li>12-fault：容错策略</li><li>13-generics：泛化调用</li><li>14-shutdown：优雅停机</li><li>15-interceptor：拦截器</li><li>16-zookeeper-listener：服务订阅</li><li>17-degradation：服务降级</li><li>18-telnet：telnet治理</li><li>19-monitor：监控</li></ul><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>JDK1.8</li><li>Maven3</li><li>IDEA</li><li>Git</li></ul><h2 id="核心技术"><a href="#核心技术" class="headerlink" title="核心技术"></a>核心技术</h2><ul><li>Java</li><li>Spring</li><li>Netty</li></ul><hr><blockquote><p>参考资料：<a href="http://www.recorddrip.com/dokuwiki/doku.php?id=%E5%88%86%E4%BA%AB:%E6%8A%80%E6%9C%AF:gxxrpc:gxxrpc%E4%BB%8B%E7%BB%8D%E6%96%87%E6%A1%A3" target="_blank" rel="noopener">http://www.recorddrip.com/dokuwiki/doku.php?id=%E5%88%86%E4%BA%AB:%E6%8A%80%E6%9C%AF:gxxrpc:gxxrpc%E4%BB%8B%E7%BB%8D%E6%96%87%E6%A1%A3</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;RPC（Remote Procedure Call）远程过程调用。本例为简易版rpc框架，实现功能与dubbo类似。&lt;/p&gt;
&lt;h2 id=&quot;RPC主调用过程&quot;&gt;&lt;a href=&quot;#RPC主调用过程&quot; class=&quot;headerlink&quot; title=&quot;RPC主调用过程&quot;&gt;&lt;/a&gt;RPC主调用过程&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://kangyonggan.com/upload/blog/rpc.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Provioder：服务提供者&lt;br&gt;Register：注册中心&lt;br&gt;Consumer：服务消费者&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;当然，这只是其中一个维度的主过程，其中还有很多花里胡哨的细节，诸如负载均衡、泛华调用、服务降级等功能。待我打通主线任务后再慢慢添加支线任务。&lt;/p&gt;
    
    </summary>
    
      <category term="Java后台" scheme="http://kangyonggan.com/categories/Java%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="Java" scheme="http://kangyonggan.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Redis分布式锁的实现</title>
    <link href="http://kangyonggan.com/2019/02/14/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
    <id>http://kangyonggan.com/2019/02/14/Redis分布式锁的实现/</id>
    <published>2019-02-14T08:37:31.000Z</published>
    <updated>2019-02-14T08:37:42.444Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Jedis版"><a href="#Jedis版" class="headerlink" title="Jedis版"></a>Jedis版</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.app.util;</span><br><span class="line"></span><br><span class="line">import redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line">import java.util.Collections;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Redis分布式锁</span><br><span class="line"> *</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2019-02-14</span><br><span class="line"> */</span><br><span class="line">public final class RedisUtil &#123;</span><br><span class="line">    private RedisUtil() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static final String LOCK_SUCCESS = &quot;OK&quot;;</span><br><span class="line">    private static final String SET_IF_NOT_EXIST = &quot;NX&quot;;</span><br><span class="line">    private static final String SET_WITH_EXPIRE_TIME = &quot;PX&quot;;</span><br><span class="line"></span><br><span class="line">    private static final Long RELEASE_SUCCESS = 1L;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 尝试获取分布式锁</span><br><span class="line">     *</span><br><span class="line">     * @param jedis      Redis客户端</span><br><span class="line">     * @param lockKey    锁</span><br><span class="line">     * @param requestId  请求标识</span><br><span class="line">     * @param expireTime 超期时间</span><br><span class="line">     * @return 是否获取成功</span><br><span class="line">     */</span><br><span class="line">    public static boolean tryGetDistributedLock(Jedis jedis, String lockKey, String requestId, int expireTime) &#123;</span><br><span class="line">        String result = jedis.set(lockKey, requestId, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, expireTime);</span><br><span class="line"></span><br><span class="line">        return LOCK_SUCCESS.equals(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 释放分布式锁</span><br><span class="line">     *</span><br><span class="line">     * @param jedis     Redis客户端</span><br><span class="line">     * @param lockKey   锁</span><br><span class="line">     * @param requestId 请求标识</span><br><span class="line">     * @return 是否释放成功</span><br><span class="line">     */</span><br><span class="line">    public static boolean releaseDistributedLock(Jedis jedis, String lockKey, String requestId) &#123;</span><br><span class="line">        String script = &quot;if redis.call(&apos;get&apos;, KEYS[1]) == ARGV[1] then return redis.call(&apos;del&apos;, KEYS[1]) else return 0 end&quot;;</span><br><span class="line">        Object result = jedis.eval(script, Collections.singletonList(lockKey), Collections.singletonList(requestId));</span><br><span class="line"></span><br><span class="line">        return RELEASE_SUCCESS.equals(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Jedis版&quot;&gt;&lt;a href=&quot;#Jedis版&quot; class=&quot;headerlink&quot; title=&quot;Jedis版&quot;&gt;&lt;/a&gt;Jedis版&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gut
      
    
    </summary>
    
      <category term="Java后台" scheme="http://kangyonggan.com/categories/Java%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="Java" scheme="http://kangyonggan.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>手写最简版Tomcat</title>
    <link href="http://kangyonggan.com/2019/02/13/%E6%89%8B%E5%86%99%E6%9C%80%E7%AE%80%E7%89%88Tomcat/"/>
    <id>http://kangyonggan.com/2019/02/13/手写最简版Tomcat/</id>
    <published>2019-02-13T06:43:23.000Z</published>
    <updated>2019-02-13T06:44:20.492Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用。</p><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>手动实现一个最简单版的tomcat，实现以下功能：  </p><ol><li>运行main方法后能监听8080端口。</li><li>收到请求后把方法和路径打印出来。</li><li>给客户端响应。</li></ol><a id="more"></a><h2 id="服务端代码"><a href="#服务端代码" class="headerlink" title="服务端代码"></a>服务端代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line">import java.net.ServerSocket;</span><br><span class="line">import java.net.Socket;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2019-02-13</span><br><span class="line"> */</span><br><span class="line">public class MyTomcat &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            ServerSocket serverSocket = new ServerSocket(8080);</span><br><span class="line">            System.out.println(&quot;Tomcat已启动，端口为8080&quot;);</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                // 等待请求</span><br><span class="line">                Socket socket = serverSocket.accept();</span><br><span class="line">                // 处理请求</span><br><span class="line">                dealSocket(socket);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            System.out.println(&quot;Tomcat启动异常&quot;);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 处理请求。</span><br><span class="line">     * 1. 解析http协议</span><br><span class="line">     * 2. 打印方法和路径</span><br><span class="line">     * 3. 写响应</span><br><span class="line">     *</span><br><span class="line">     * @param socket</span><br><span class="line">     */</span><br><span class="line">    private static void dealSocket(Socket socket) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            BufferedReader reader = new BufferedReader(new InputStreamReader(socket.getInputStream()));</span><br><span class="line">            // 读取http协议的第一行，例：GET /hello?name=tomcat HTTP/1.1</span><br><span class="line">            String line = reader.readLine();</span><br><span class="line">            if (line != null) &#123;</span><br><span class="line">                System.out.println(&quot;===================Request==================&quot;);</span><br><span class="line">                String[] arr = line.split(&quot;\\s&quot;);</span><br><span class="line">                System.out.println(&quot;请求方法：&quot; + arr[0]);</span><br><span class="line">                System.out.println(&quot;请求路径：&quot; + arr[1]);</span><br><span class="line">                System.out.println(&quot;===================Request==================&quot;);</span><br><span class="line"></span><br><span class="line">                // 写响应</span><br><span class="line">                System.out.println(&quot;===================Response==================&quot;);</span><br><span class="line">                String respMsg = &quot;Hello Tomcat&quot;;</span><br><span class="line">                BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));</span><br><span class="line">                // 响应内容必须符合http协议</span><br><span class="line">                String result = &quot;HTTP/1.1\nContent-type:text/html\n\n&quot; + respMsg;</span><br><span class="line">                System.out.println(respMsg);</span><br><span class="line">                writer.write(result);</span><br><span class="line">                writer.flush();</span><br><span class="line">                writer.close();</span><br><span class="line">                System.out.println(&quot;===================Response==================\n\n&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (socket != null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>打开浏览器访问：<a href="http://localhost:8080/hello?name=tomcat" target="_blank" rel="noopener">http://localhost:8080/hello?name=tomcat</a></p><p>页面响应内容为：<br>Hello Tomcat</p><p>下面是一个完整的请求头供参考：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /hello?name=tomcat HTTP/1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,id;q=0.7,en-US;q=0.6</span><br><span class="line">Cookie: Idea-52bd2c0d=07a72752-b112-4867-88bd-58492f6658f9; bdshare_firstime=1546588983975; Hm_lvt_6a4086b67794408d40551fa5c68a96d8=1547430617,1547779481,1548318195,1548820657</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用。&lt;/p&gt;
&lt;h2 id=&quot;目标&quot;&gt;&lt;a href=&quot;#目标&quot; class=&quot;headerlink&quot; title=&quot;目标&quot;&gt;&lt;/a&gt;目标&lt;/h2&gt;&lt;p&gt;手动实现一个最简单版的tomcat，实现以下功能：  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;运行main方法后能监听8080端口。&lt;/li&gt;
&lt;li&gt;收到请求后把方法和路径打印出来。&lt;/li&gt;
&lt;li&gt;给客户端响应。&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Java后台" scheme="http://kangyonggan.com/categories/Java%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="Java" scheme="http://kangyonggan.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>一套完整的生成缩略图及点击缩略图显示原图的解决方案</title>
    <link href="http://kangyonggan.com/2019/01/24/%E4%B8%80%E5%A5%97%E5%AE%8C%E6%95%B4%E7%9A%84%E7%94%9F%E6%88%90%E7%BC%A9%E7%95%A5%E5%9B%BE%E5%8F%8A%E7%82%B9%E5%87%BB%E7%BC%A9%E7%95%A5%E5%9B%BE%E6%98%BE%E7%A4%BA%E5%8E%9F%E5%9B%BE%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>http://kangyonggan.com/2019/01/24/一套完整的生成缩略图及点击缩略图显示原图的解决方案/</id>
    <published>2019-01-24T10:30:20.641Z</published>
    <updated>2019-01-24T10:30:20.641Z</updated>
    
    <content type="html"><![CDATA[<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p><a href="https://kangyonggan.com/album">https://kangyonggan.com/album</a><br><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzhrslbd1fj31110u0thf.jpg" alt=""></p><a id="more"></a><h2 id="使用缩略图的优点"><a href="#使用缩略图的优点" class="headerlink" title="使用缩略图的优点"></a>使用缩略图的优点</h2><p>可以减轻服务器压力，给用户更好的体验。一个界面可能有很多图片，但是用户关心的图片可能只有那么一两个，如果我们加载全部原图，并且原图很大的时候，会浪费很多服务器资源，并且用户会看见大量图片处于加载中(如下图)。<br>如果使用缩略图，就可以解决这个问题。<br><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fzhrsp4qjfj31mk0oqmyi.jpg" alt=""></p><h2 id="如何生成缩略图"><a href="#如何生成缩略图" class="headerlink" title="如何生成缩略图"></a>如何生成缩略图</h2><p>如果只是简单的生成缩略图，方法有很多，但是如何生成一个”好看”的缩略图呢？先捋一下思路，如下：</p><h3 id="仅压缩"><a href="#仅压缩" class="headerlink" title="仅压缩"></a>仅压缩</h3><p>如果强行把一个长图压缩成宽图，就可能导致图片中的人变矮变胖。<br><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzhrsmp8bpj310u0g476z.jpg" alt=""></p><h3 id="仅剪裁"><a href="#仅剪裁" class="headerlink" title="仅剪裁"></a>仅剪裁</h3><p>如果把一个大图，比如：800x2000的图，剪裁成400x300的图，可能图片中的主要内容根本都显示出来。<br><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzhrubyo37j316x0u0qub.jpg" alt=""></p><h3 id="剪裁中心区域"><a href="#剪裁中心区域" class="headerlink" title="剪裁中心区域"></a>剪裁中心区域</h3><p>一般来说，图片中心是主要内容，我们剪裁中心区域400x300的图。<br><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fzhry5hld2j319t0u0u0b.jpg" alt=""></p><h3 id="等比例压缩后再剪裁中心区域"><a href="#等比例压缩后再剪裁中心区域" class="headerlink" title="等比例压缩后再剪裁中心区域"></a>等比例压缩后再剪裁中心区域</h3><p>虽然好了很多，但是还有一个明显的问题，那就是图片包含的内容太少了，因此我先把原图等比例压缩成400x1000的图片，在剪裁中心区域的400x300。<br><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fzhs4u982aj317u0u04o7.jpg" alt=""></p><p>注意：如果是宽图，先把高度压成300，再把宽度等比例压缩，最后剪裁中心区域。</p><h3 id="java代码实现"><a href="#java代码实现" class="headerlink" title="java代码实现"></a>java代码实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.app.util;</span><br><span class="line"></span><br><span class="line">import javax.imageio.ImageIO;</span><br><span class="line">import java.awt.geom.AffineTransform;</span><br><span class="line">import java.awt.image.AffineTransformOp;</span><br><span class="line">import java.awt.image.BufferedImage;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @date 6/23/17</span><br><span class="line"> */</span><br><span class="line">public final class Images &#123;</span><br><span class="line"></span><br><span class="line">    private Images() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 生成缩略图。</span><br><span class="line">     *</span><br><span class="line">     * @param source 原图（大）</span><br><span class="line">     * @param desc   目标图片</span><br><span class="line">     * @param width  目标宽</span><br><span class="line">     * @param height 目标高</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    public static void thumb(String source, String desc, int width, int height) throws Exception &#123;</span><br><span class="line">        BufferedImage image = ImageIO.read(new FileInputStream(source));</span><br><span class="line"></span><br><span class="line">        // 判断原图的长宽比是不是比目标图的长宽比大，用于计算压缩后的宽和高</span><br><span class="line">        int pressWidth;</span><br><span class="line">        int pressHeight;</span><br><span class="line">        if (image.getHeight() * 1.0 / image.getWidth() &gt; height * 1.0 / width) &#123;</span><br><span class="line">            // 原图是高图</span><br><span class="line">            // 让压缩后的宽度等于目标宽度</span><br><span class="line">            pressWidth = width;</span><br><span class="line">            // 等比例计算高度</span><br><span class="line">            pressHeight = (int) (1.0 * image.getHeight() * width / image.getWidth());</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 原图是宽图</span><br><span class="line">            // 让压缩后的高度等于目标高度</span><br><span class="line">            pressHeight = height;</span><br><span class="line">            // 等比例计算高度</span><br><span class="line">            pressWidth = (int) (1.0 * image.getWidth() * height / image.getHeight());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 先压缩</span><br><span class="line">        BufferedImage temp = zoomImage(image, pressWidth, pressHeight);</span><br><span class="line"></span><br><span class="line">        // 再截取</span><br><span class="line">        int x = (temp.getWidth() - width) / 2;</span><br><span class="line">        int y = (temp.getHeight() - height) / 2;</span><br><span class="line">        temp = temp.getSubimage(x, y, width, height);</span><br><span class="line"></span><br><span class="line">        // 最后写文件</span><br><span class="line">        ImageIO.write(temp, &quot;png&quot;, new FileOutputStream(desc));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 缩放图片</span><br><span class="line">     *</span><br><span class="line">     * @param image</span><br><span class="line">     * @param w</span><br><span class="line">     * @param h</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    private static BufferedImage zoomImage(BufferedImage image, int w, int h) throws Exception &#123;</span><br><span class="line">        double wr = w * 1.0 / image.getWidth();</span><br><span class="line">        double hr = h * 1.0 / image.getHeight();</span><br><span class="line"></span><br><span class="line">        AffineTransformOp ato = new AffineTransformOp(AffineTransform.getScaleInstance(wr, hr), null);</span><br><span class="line">        return ato.filter(image, null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        thumb(&quot;/Users/kyg/Desktop/origin.jpeg&quot;, &quot;/Users/kyg/Desktop/demo.png&quot;, 400, 300);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面过程仅是生成缩略图，当生成缩略图后，我们要在网站上展示缩略图，点击放大可查看原图。为此，我写了一个jQuery插件，如下。</p><h2 id="zoomer的使用"><a href="#zoomer的使用" class="headerlink" title="zoomer的使用"></a>zoomer的使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul class=&quot;list&quot;&gt;</span><br><span class="line">    &lt;li&gt;</span><br><span class="line">        &lt;img src=&quot;thubm_1.png&quot; data-origin=&quot;1.png&quot;/&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li&gt;</span><br><span class="line">        &lt;img src=&quot;thubm_2.png&quot;/&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li&gt;</span><br><span class="line">        &lt;img src=&quot;thubm_3.png&quot; data-origin=&quot;3.png&quot;/&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;jquery/jquery-1.8.3.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;zoomer/zoomer.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(function () &#123;</span><br><span class="line">        $(&quot;.list&quot;).zoomer();</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="zoomer-js源码"><a href="#zoomer-js源码" class="headerlink" title="zoomer.js源码"></a>zoomer.js源码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 图片缩放</span><br><span class="line"> *</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2017/3/21</span><br><span class="line"> */</span><br><span class="line">(function ($) &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 总入口</span><br><span class="line">     *</span><br><span class="line">     * @param $target</span><br><span class="line">     * @param settings</span><br><span class="line">     */</span><br><span class="line">    function Zoomer($target, settings) &#123;</span><br><span class="line">        // 把settings的属性合并到defaults，并且不改变defaults</span><br><span class="line">        settings = $.extend(true, $.fn.zoomer.defaults, settings);</span><br><span class="line"></span><br><span class="line">        // 模态框图层</span><br><span class="line">        var $overlay = $();</span><br><span class="line">        // 全部图片</span><br><span class="line">        var $allImgs = $target.find(&quot;img&quot;);</span><br><span class="line"></span><br><span class="line">        // 修改光标</span><br><span class="line">        $allImgs.css(&quot;cursor&quot;, &quot;zoom-in&quot;);</span><br><span class="line"></span><br><span class="line">        // 给每个img一个下标</span><br><span class="line">        for (var i = 0; i &lt; $allImgs.length; i++) &#123;</span><br><span class="line">            $($allImgs[i]).data(&quot;index&quot;, i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 绑定点击事件</span><br><span class="line">        $allImgs.click(function () &#123;</span><br><span class="line">            showModal($(this));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 显示模态框</span><br><span class="line">         *</span><br><span class="line">         * @param $img</span><br><span class="line">         */</span><br><span class="line">        function showModal($img) &#123;</span><br><span class="line">            $overlay.remove();</span><br><span class="line">            var src = $img.data(&apos;origin&apos;);</span><br><span class="line">            if (!src) &#123;</span><br><span class="line">                src = $img.attr(&apos;src&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">            var index = $img.data(&quot;index&quot;);</span><br><span class="line"></span><br><span class="line">            $overlay = $(&apos;&lt;div&gt;&apos; +</span><br><span class="line">                &apos;&lt;a href=&quot;javascript:&quot; class=&quot;zoomer-prev-img&quot; data-index=&quot;&apos; + index + &apos;&quot; style=&quot;display: none; position: absolute;z-index: 1;&quot;&gt;&lt;/a&gt;&apos; +</span><br><span class="line">                &apos;&lt;a href=&quot;javascript:&quot; class=&quot;zoomer-next-img&quot; data-index=&quot;&apos; + index + &apos;&quot; style=&quot;display: none; position: absolute;z-index: 1;&quot;&gt;&lt;/a&gt;&apos; +</span><br><span class="line">                &apos;&lt;div style=&quot;text-align: center;color: #ddd;position: absolute;left: 0;right: 0;top: 40%;&quot;&gt;加载中...&lt;/div&gt;&apos; +</span><br><span class="line">                &apos;&lt;img src=&quot;&apos; + src + &apos;&quot; style=&quot;max-width: 100%;max-height: 100%;display: none&quot;/&gt;&lt;/div&gt;&apos;).css(&#123;</span><br><span class="line">                position: &quot;fixed&quot;,</span><br><span class="line">                left: 0,</span><br><span class="line">                top: 0,</span><br><span class="line">                bottom: 0,</span><br><span class="line">                right: 0,</span><br><span class="line">                color: &apos;#fff&apos;,</span><br><span class="line">                zIndex: 9999,</span><br><span class="line">                cursor: &apos;zoom-out&apos;,</span><br><span class="line">                background: &apos;rgba(0, 0, 0, 0.4)&apos;,</span><br><span class="line">                textAlign: &quot;center&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">            $(&quot;body&quot;).append($overlay);</span><br><span class="line"></span><br><span class="line">            // 图片加载完成事件</span><br><span class="line">            $overlay.find(&quot;img&quot;).load(function () &#123;</span><br><span class="line">                // 图片距离顶部的距离</span><br><span class="line">                var top = ($(window).height() - $(this).height()) / 2;</span><br><span class="line">                // 图片距离左边的距离</span><br><span class="line">                var left = ($(window).width() - $(this).width()) / 2;</span><br><span class="line"></span><br><span class="line">                // 上一张</span><br><span class="line">                $(this).parents(&quot;div&quot;).find(&quot;.zoomer-prev-img&quot;).css(&#123;</span><br><span class="line">                    &quot;display&quot;: &quot;inline-block&quot;,</span><br><span class="line">                    &quot;top&quot;: top + &quot;px&quot;,</span><br><span class="line">                    &quot;left&quot;: left + &quot;px&quot;,</span><br><span class="line">                    &quot;bottom&quot;: top + &quot;px&quot;,</span><br><span class="line">                    &quot;width&quot;: $(this).width() / 3 + &quot;px&quot;</span><br><span class="line">                &#125;).hover(function () &#123;</span><br><span class="line">                    $(this).css(&#123;</span><br><span class="line">                        background: &quot;-webkit-linear-gradient(left, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0))&quot;,</span><br><span class="line">                        background: &quot;-o-linear-gradient(right, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0))&quot;,</span><br><span class="line">                        background: &quot;-moz-linear-gradient(right, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0))&quot;,</span><br><span class="line">                        background: &quot;linear-gradient(to right, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0))&quot;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;, function () &#123;</span><br><span class="line">                    $(this).css(&#123;</span><br><span class="line">                        &quot;background&quot;: &quot;rgba(0, 0, 0, 0.0)&quot;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                // 下一张</span><br><span class="line">                $(this).parents(&quot;div&quot;).find(&quot;.zoomer-next-img&quot;).css(&#123;</span><br><span class="line">                    &quot;display&quot;: &quot;inline-block&quot;,</span><br><span class="line">                    &quot;top&quot;: top + &quot;px&quot;,</span><br><span class="line">                    &quot;right&quot;: left + &quot;px&quot;,</span><br><span class="line">                    &quot;bottom&quot;: top + &quot;px&quot;,</span><br><span class="line">                    &quot;width&quot;: $(this).width() / 3 + &quot;px&quot;</span><br><span class="line">                &#125;).hover(function () &#123;</span><br><span class="line">                    $(this).css(&#123;</span><br><span class="line">                        background: &quot;-webkit-linear-gradient(left, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.3))&quot;,</span><br><span class="line">                        background: &quot;-o-linear-gradient(right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.3))&quot;,</span><br><span class="line">                        background: &quot;-moz-linear-gradient(right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.3))&quot;,</span><br><span class="line">                        background: &quot;linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.3))&quot;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;, function () &#123;</span><br><span class="line">                    $(this).css(&#123;</span><br><span class="line">                        &quot;background&quot;: &quot;rgba(0, 0, 0, 0.0)&quot;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                $(this).parents(&quot;div&quot;).find(&quot;div&quot;).css(&#123;&quot;display&quot;: &quot;none&quot;&#125;);</span><br><span class="line">                $(this).css(&#123;&quot;display&quot;: &quot;inline-block&quot;, &quot;marginTop&quot;: top + &quot;px&quot;&#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            // 图片加载失败事件</span><br><span class="line">            $overlay.find(&quot;img&quot;).error(function () &#123;</span><br><span class="line">                if (settings.failure &amp;&amp; typeof settings.failure === &apos;function&apos;) &#123;</span><br><span class="line">                    settings.failure($(this), $allImgs, $target, $overlay);</span><br><span class="line">                &#125;</span><br><span class="line">                $(this).parents(&quot;div&quot;).find(&quot;div&quot;).html(&quot;加载失败！&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            // 给模态框绑定点击事件</span><br><span class="line">            $overlay.click(function () &#123;</span><br><span class="line">                $overlay.remove();</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            // 上一张事件</span><br><span class="line">            $overlay.find(&quot;.zoomer-prev-img&quot;).click(function () &#123;</span><br><span class="line">                var index = $(this).data(&quot;index&quot;);</span><br><span class="line">                if (index === 0) &#123;</span><br><span class="line">                    $overlay.remove();</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                showModal($($allImgs[index - 1]));</span><br><span class="line">                return false;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            // 下一张事件</span><br><span class="line">            $overlay.find(&quot;.zoomer-next-img&quot;).click(function () &#123;</span><br><span class="line">                var index = $(this).data(&quot;index&quot;);</span><br><span class="line">                if (index === $allImgs.length - 1) &#123;</span><br><span class="line">                    $overlay.remove();</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                showModal($($allImgs[index + 1]));</span><br><span class="line">                return false;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 图片缩放</span><br><span class="line">     *</span><br><span class="line">     * @param option</span><br><span class="line">     * @returns &#123;*&#125;</span><br><span class="line">     */</span><br><span class="line">    $.fn.zoomer = function (option) &#123;</span><br><span class="line">        return this.each(function () &#123;</span><br><span class="line">            $(this).data(&apos;zoomer&apos;, new Zoomer($(this), option));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 默认配置</span><br><span class="line">     *</span><br><span class="line">     * @type &#123;&#123;failure: null&#125;&#125;</span><br><span class="line">     */</span><br><span class="line">    $.fn.zoomer.defaults = &#123;</span><br><span class="line">        // 图片加载失败回调</span><br><span class="line">        failure: null</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(window.jQuery);</span><br></pre></td></tr></table></figure><h3 id="zoomer下载"><a href="#zoomer下载" class="headerlink" title="zoomer下载"></a>zoomer下载</h3><p><a href="/uploads/zoomer.js">zoomer.js</a><br><a href="/uploads/zoomer.min.js">zoomer.min.js</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;实例&quot;&gt;&lt;a href=&quot;#实例&quot; class=&quot;headerlink&quot; title=&quot;实例&quot;&gt;&lt;/a&gt;实例&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://kangyonggan.com/album&quot;&gt;https://kangyonggan.com/album&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;https://ws4.sinaimg.cn/large/006tNc79ly1fzhrslbd1fj31110u0thf.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>纯前端JS生成GIF</title>
    <link href="http://kangyonggan.com/2019/01/18/%E7%BA%AF%E5%89%8D%E7%AB%AFJS%E7%94%9F%E6%88%90GIF/"/>
    <id>http://kangyonggan.com/2019/01/18/纯前端JS生成GIF/</id>
    <published>2019-01-18T02:42:35.000Z</published>
    <updated>2019-01-18T03:14:47.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p><a href="https://kangyonggan.com/tool/gif">https://kangyonggan.com/tool/gif</a><br><img src="/uploads/gif-1.png" alt=""></p><a id="more"></a><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ol><li>选择文件后并不会上传至服务器，因此你可以很大很大的图片。</li><li>不管你选择多大的图片，最终生成的gif都会很小。</li><li>gif被压缩后会失真，会有一定程度的模糊。</li></ol><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><p><a href="/uploads/gif.zip">gif.zip</a></p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; data-index=&quot;0&quot;/&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; data-index=&quot;1&quot;/&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; data-index=&quot;2&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;开始生成&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;canvas width=&quot;400&quot; height=&quot;300&quot; id=&quot;canvas&quot; style=&quot;display:none&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;img src=&quot;&quot; id=&quot;result&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;../jquery/jquery-1.8.3.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;gif.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(function () &#123;</span><br><span class="line">        // 生成gif的图片源</span><br><span class="line">        var imgList = [];</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 选择图片</span><br><span class="line">         */</span><br><span class="line">        $(&quot;input[type=file]&quot;).change(function (e) &#123;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">            var pic = this.files[0];</span><br><span class="line">            // TODO 校验是不是图片格式（自行实现）</span><br><span class="line"></span><br><span class="line">            // TODO 图片预览（自行实现，可参考：https://blog.kangyonggan.com/2019/01/14/%E7%BE%8E%E5%8C%96%E6%96%87%E4%BB%B6%E9%80%89%E6%8B%A9%E6%A1%86/）</span><br><span class="line"></span><br><span class="line">            // 把选中的图片加到图片源 imgList</span><br><span class="line">            var file = new FileReader();</span><br><span class="line">            file.readAsDataURL(pic);</span><br><span class="line"></span><br><span class="line">            // 图片的下标</span><br><span class="line">            var index = $(this).data(&quot;index&quot;);</span><br><span class="line"></span><br><span class="line">            file.onload = function () &#123;</span><br><span class="line">                imgList[index] = this.result;</span><br><span class="line">            &#125;;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        var gif;</span><br><span class="line">        var canvas = document.getElementById(&apos;canvas&apos;);</span><br><span class="line">        var ctx = canvas.getContext(&apos;2d&apos;);</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 开始生成</span><br><span class="line">         */</span><br><span class="line">        $(&quot;#btn&quot;).click(function () &#123;</span><br><span class="line">            gif = new GIF(&#123;</span><br><span class="line">                workers: imgList.length,</span><br><span class="line">                quality: 30,</span><br><span class="line">                workerScript: &quot;gif.worker.js&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">            gif.on(&quot;finished&quot;, function (blob) &#123;</span><br><span class="line">                var file = new FileReader();</span><br><span class="line">                file.readAsDataURL(blob);</span><br><span class="line">                file.onload = function () &#123;</span><br><span class="line">                    document.getElementById(&quot;result&quot;).setAttribute(&quot;src&quot;, file.result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            var imgObjList = [], count = 0;</span><br><span class="line"></span><br><span class="line">            for (var i = 0; i &lt; imgList.length; i++) &#123;</span><br><span class="line">                var tmpImg = new Image();</span><br><span class="line">                tmpImg.src = imgList[i];</span><br><span class="line">                imgObjList.push(tmpImg);</span><br><span class="line">                tmpImg.onload = function () &#123;</span><br><span class="line">                    count++;</span><br><span class="line">                    if (count === imgList.length) &#123;</span><br><span class="line">                        generateGif(imgObjList);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 生成gif</span><br><span class="line">         *</span><br><span class="line">         * @param imgObjList</span><br><span class="line">         */</span><br><span class="line">        function generateGif(imgObjList) &#123;</span><br><span class="line">            for (var i = 0; i &lt; imgObjList.length; i++) &#123;</span><br><span class="line">                ctx.save();</span><br><span class="line">                ctx.drawImage(imgObjList[i], 0, 0, canvas.width, canvas.height);</span><br><span class="line"></span><br><span class="line">                // 给图片配字幕</span><br><span class="line">//                ctx.font = &quot;14px 宋体&quot;;</span><br><span class="line">//                ctx.fillStyle = &quot;White&quot;;</span><br><span class="line">//                ctx.textAlign = &quot;center&quot;;</span><br><span class="line">//                ctx.fillText(title, 200, 280);</span><br><span class="line"></span><br><span class="line">                ctx.restore();</span><br><span class="line">                gif.addFrame(canvas, &#123;copy: true, delay: 1500&#125;);</span><br><span class="line">                ctx.clearRect(0, 0, canvas.width, canvas.height)</span><br><span class="line">            &#125;</span><br><span class="line">            gif.render();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p><img src="/uploads/gif-2.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;实例&quot;&gt;&lt;a href=&quot;#实例&quot; class=&quot;headerlink&quot; title=&quot;实例&quot;&gt;&lt;/a&gt;实例&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://kangyonggan.com/tool/gif&quot;&gt;https://kangyonggan.com/tool/gif&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;/uploads/gif-1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Web前端" scheme="http://kangyonggan.com/categories/Web%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>使用freemarker手动实现i18n</title>
    <link href="http://kangyonggan.com/2019/01/14/%E4%BD%BF%E7%94%A8freemarker%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0i18n/"/>
    <id>http://kangyonggan.com/2019/01/14/使用freemarker手动实现i18n/</id>
    <published>2019-01-14T02:27:15.000Z</published>
    <updated>2019-01-14T02:49:37.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="FTL中的调用效果"><a href="#FTL中的调用效果" class="headerlink" title="FTL中的调用效果"></a>FTL中的调用效果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;@message &quot;app.name&quot;/&gt;</span><br><span class="line">&lt;@message &quot;app.name&quot; local=&quot;zh_CN&quot;/&gt;</span><br></pre></td></tr></table></figure><h2 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a>宏定义</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro message code local=&quot;&quot;&gt;</span><br><span class="line">    &lt;#if local!=&quot;&quot;&gt;</span><br><span class="line">        $&#123;i18n(&quot;msg&quot;, code, local)&#125;</span><br><span class="line">    &lt;#else&gt;</span><br><span class="line">        $&#123;i18n(&quot;msg&quot;, code, &apos;$&#123;springMacroRequestContext.getLocale().language&#125;_$&#123;springMacroRequestContext.getLocale().country&#125;&apos;)&#125;</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">package com.kangyonggan.demo.freemarker;</span><br><span class="line"></span><br><span class="line">import lombok.extern.log4j.Log4j2;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author kangyonggan</span><br><span class="line"> * @since 2018/12/13</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">@Log4j2</span><br><span class="line">public class I18nTag extends AbstractFunctionTag &#123;</span><br><span class="line"></span><br><span class="line">    private static Map&lt;String, Properties&gt; data = new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 国际化</span><br><span class="line">     *</span><br><span class="line">     * @param arguments 参数</span><br><span class="line">     * @return 返回UUID</span><br><span class="line">     */</span><br><span class="line">    public String msg(List arguments) throws IOException &#123;</span><br><span class="line">        if (!hasLessThreeArgs(arguments)) &#123;</span><br><span class="line">            throw new RuntimeException(&quot;国际化时没有指定参数&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        String code = arguments.get(1).toString();</span><br><span class="line">        String local = arguments.get(2).toString();</span><br><span class="line"></span><br><span class="line">        Properties properties = getProperties(local);</span><br><span class="line">        return properties.getProperty(code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Properties getProperties(String local) throws IOException &#123;</span><br><span class="line">        Properties properties = data.get(local);</span><br><span class="line"></span><br><span class="line">        if (properties == null) &#123;</span><br><span class="line">            properties = loadProperties(local);</span><br><span class="line">            data.put(local, properties);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Properties loadProperties(String local) throws IOException &#123;</span><br><span class="line">        Properties properties = new Properties();</span><br><span class="line">        InputStream inputStream;</span><br><span class="line">        try &#123;</span><br><span class="line">            inputStream = this.getClass().getResourceAsStream(&quot;/messages_&quot; + local + &quot;.properties&quot;);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            inputStream = null;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (inputStream == null) &#123;</span><br><span class="line">            log.info(&quot;没有&#123;&#125;的国际化文件，使用默认的&quot;, local);</span><br><span class="line">            inputStream = this.getClass().getResourceAsStream(&quot;/messages.properties&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        InputStreamReader reader = new InputStreamReader(inputStream, &quot;UTF-8&quot;);</span><br><span class="line">        properties.load(reader);</span><br><span class="line">        return properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="properties文件"><a href="#properties文件" class="headerlink" title="properties文件"></a>properties文件</h2><p><code>messages.properties</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.name=dfjz</span><br></pre></td></tr></table></figure><p><code>messages_zh_CN.properties</code>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.name=东方骄子</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;FTL中的调用效果&quot;&gt;&lt;a href=&quot;#FTL中的调用效果&quot; class=&quot;headerlink&quot; title=&quot;FTL中的调用效果&quot;&gt;&lt;/a&gt;FTL中的调用效果&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;@message &amp;quot;app.name&amp;quot;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;@message &amp;quot;app.name&amp;quot; local=&amp;quot;zh_CN&amp;quot;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;宏定义&quot;&gt;&lt;a href=&quot;#宏定义&quot; class=&quot;headerlink&quot; title=&quot;宏定义&quot;&gt;&lt;/a&gt;宏定义&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;#macro message code local=&amp;quot;&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;#if local!=&amp;quot;&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        $&amp;#123;i18n(&amp;quot;msg&amp;quot;, code, local)&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;#else&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        $&amp;#123;i18n(&amp;quot;msg&amp;quot;, code, &amp;apos;$&amp;#123;springMacroRequestContext.getLocale().language&amp;#125;_$&amp;#123;springMacroRequestContext.getLocale().country&amp;#125;&amp;apos;)&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;/#if&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/#macro&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Java后台" scheme="http://kangyonggan.com/categories/Java%E5%90%8E%E5%8F%B0/"/>
    
    
      <category term="Java" scheme="http://kangyonggan.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>美化文件选择框</title>
    <link href="http://kangyonggan.com/2019/01/14/%E7%BE%8E%E5%8C%96%E6%96%87%E4%BB%B6%E9%80%89%E6%8B%A9%E6%A1%86/"/>
    <id>http://kangyonggan.com/2019/01/14/美化文件选择框/</id>
    <published>2019-01-14T01:46:19.000Z</published>
    <updated>2019-01-14T02:04:46.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="效果预览"><a href="#效果预览" class="headerlink" title="效果预览"></a>效果预览</h2><p>美化后</p><p><img src="/uploads/file-input-2.png" alt=""></p><a id="more"></a><p>美化前</p><p><img src="/uploads/file-input-1.png" alt=""></p><h2 id="原生代码"><a href="#原生代码" class="headerlink" title="原生代码"></a>原生代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;file&quot;/&gt;</span><br></pre></td></tr></table></figure><h2 id="美化思路"><a href="#美化思路" class="headerlink" title="美化思路"></a>美化思路</h2><ol><li>隐藏原生的丑陋的文件选择框。</li><li>画一个漂亮的假的”文件选择框”。</li><li>监听假文件选择框的click事件，在事件中触发真的文件选择框的click事件，此时会弹出文件选择。</li><li>监听真的文件选择框的change事件，当文件改变时把文件（图片）显示在假文件选择框的位置，又叫做预览。</li></ol><h2 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h2><p>CSS样式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">.file &#123;</span><br><span class="line">    width: 230px;</span><br><span class="line">    height: 160px;</span><br><span class="line">    border: 1px dashed #ccc;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.file:hover &#123;</span><br><span class="line">    border: 1px dashed #a72c11;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#previewImg &#123;</span><br><span class="line">    width: 230px;</span><br><span class="line">    height: 160px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.file-label &#123;</span><br><span class="line">    text-align: center;</span><br><span class="line">    line-height: 160px;</span><br><span class="line">    color: #999;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.file-label:hover &#123;</span><br><span class="line">    color: #a72c11;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.file-warn &#123;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">    color: #aaa;</span><br><span class="line">    line-height: 1.8;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.hidden &#123;</span><br><span class="line">    display: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>html代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;file&quot;&gt;</span><br><span class="line">    &lt;img id=&quot;previewImg&quot; class=&quot;hidden&quot;/&gt;</span><br><span class="line">    &lt;div class=&quot;file-label&quot;&gt;上传视频封面&lt;/div&gt;</span><br><span class="line">    &lt;input type=&quot;file&quot; id=&quot;cover&quot; class=&quot;hidden&quot; name=&quot;file&quot;/&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;p class=&quot;file-warn&quot;&gt;</span><br><span class="line">    请上传 jpeg,jpg,png,gif 格式的图片文件，文件大小不能超过2MB。&lt;br/&gt;</span><br><span class="line">    建议上传一张 230*160 像素或等比例的图片。&lt;br/&gt;</span><br><span class="line">    精美封面图有助于吸引观看，并且更易获得官方推荐。&lt;br/&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>js代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;../static/libs/jquery/jquery-1.8.3.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(function () &#123;</span><br><span class="line">        // 点击上传图片</span><br><span class="line">        $(&quot;.file-label&quot;).click(function () &#123;</span><br><span class="line">            document.getElementById(&quot;cover&quot;).click();</span><br><span class="line">        &#125;);</span><br><span class="line">        // 点击上传图片</span><br><span class="line">        $(&quot;#previewImg&quot;).click(function () &#123;</span><br><span class="line">            document.getElementById(&quot;cover&quot;).click();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        // 图片改变事件</span><br><span class="line">        $(&quot;#cover&quot;).change(function () &#123;</span><br><span class="line">            var pic = this.files[0];</span><br><span class="line">            // 校验</span><br><span class="line">            if (!validPic(pic)) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // 图片预览</span><br><span class="line">            previewImg(pic);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        // 图片预览</span><br><span class="line">        function previewImg(pic) &#123;</span><br><span class="line">            var r = new FileReader();</span><br><span class="line">            r.readAsDataURL(pic);</span><br><span class="line"></span><br><span class="line">            r.onload = function () &#123;</span><br><span class="line">                $(&quot;#previewImg&quot;).attr(&quot;src&quot;, this.result).show();</span><br><span class="line">                $(&quot;.file-label&quot;).hide();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;效果预览&quot;&gt;&lt;a href=&quot;#效果预览&quot; class=&quot;headerlink&quot; title=&quot;效果预览&quot;&gt;&lt;/a&gt;效果预览&lt;/h2&gt;&lt;p&gt;美化后&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/uploads/file-input-2.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Web前端" scheme="http://kangyonggan.com/categories/Web%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>纯前端markdown编辑器及解析</title>
    <link href="http://kangyonggan.com/2019/01/08/%E7%BA%AF%E5%89%8D%E7%AB%AFmarkdown%E7%BC%96%E8%BE%91%E5%99%A8%E5%8F%8A%E8%A7%A3%E6%9E%90/"/>
    <id>http://kangyonggan.com/2019/01/08/纯前端markdown编辑器及解析/</id>
    <published>2019-01-08T06:37:21.000Z</published>
    <updated>2019-01-08T06:56:46.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="markdown编辑器"><a href="#markdown编辑器" class="headerlink" title="markdown编辑器"></a>markdown编辑器</h2><p>下面是使用freemarker定义的宏，是一个markdown编辑器。</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;#--markdown编辑器--&gt;</span><br><span class="line">&lt;#macro markdown name id=&quot;&quot; value=&quot;&quot;&gt;</span><br><span class="line">&lt;#if id==&quot;&quot;&gt;</span><br><span class="line">    &lt;#local id=func(&apos;uuid&apos;, &apos;id&apos;)/&gt;</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;$&#123;ctx&#125;/libs/editor.md/css/editormd.css&quot;/&gt;</span><br><span class="line">&lt;div id=&quot;$&#123;id&#125;&quot;&gt;</span><br><span class="line">    &lt;textarea style=&quot;display: none&quot; name=&quot;$&#123;name&#125;&quot;&gt;$&#123;value&#125;&lt;/textarea&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;$&#123;ctx&#125;/libs/editor.md/editormd.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(function () &#123;</span><br><span class="line">        editormd(&quot;$&#123;id&#125;&quot;, &#123;</span><br><span class="line">            height: 600,</span><br><span class="line">            syncScrolling: &quot;single&quot;,</span><br><span class="line">            path: &quot;$&#123;ctx&#125;/libs/editor.md/lib/&quot;,</span><br><span class="line">            emoji: true,</span><br><span class="line">            imageUpload: true,</span><br><span class="line">            imageUploadURL: &quot;$&#123;ctx&#125;/file/markdown&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure><p>用例：&lt;@ca.markdown name=”content” value=”${article.content!’’}”/&gt;</p><ol><li>editor.md官网地址：<a href="http://pandao.github.io/editor.md/examples/" target="_blank" rel="noopener">http://pandao.github.io/editor.md/examples/</a></li><li>&lt;#local id=func(‘uuid’, ‘id’)/&gt; 是产生一个uuid。</li><li>imageUploadURL 是图片上传地址，需要写一个controller，如下。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * md编辑器文件、图片上传</span><br><span class="line"> *</span><br><span class="line"> * @param request 请求</span><br><span class="line"> * @return 响应</span><br><span class="line"> */</span><br><span class="line">@PostMapping(&quot;markdown&quot;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public Response markdown(HttpServletRequest request) &#123;</span><br><span class="line">    Response response = Response.getResponse();</span><br><span class="line">    ServletContext context = request.getServletContext();</span><br><span class="line"></span><br><span class="line">    //上传本地文件</span><br><span class="line">    int success = 0;</span><br><span class="line">    String message = &quot;上传成功&quot;;</span><br><span class="line">    try &#123;</span><br><span class="line">        MultipartHttpServletRequest multiRequest = (MultipartHttpServletRequest) request;</span><br><span class="line">        Iterator iterator = multiRequest.getFileNames();</span><br><span class="line">        if (iterator.hasNext()) &#123;</span><br><span class="line">            MultipartFile file = multiRequest.getFile(iterator.next().toString());</span><br><span class="line">            String fileName = ftpService.genFileName(&quot;ARTICLE&quot;);</span><br><span class="line">            // 上传到本地</span><br><span class="line">            FileUpload.upload(fileUploadPath, fileName, file);</span><br><span class="line"></span><br><span class="line">            fileName += &quot;.&quot; + FilenameUtils.getExtension(file.getOriginalFilename());</span><br><span class="line">            response.put(&quot;url&quot;, context.getContextPath() + &quot;/upload/&quot; + fileName);</span><br><span class="line">            success = 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        log.error(&quot;编辑器上传文件失败&quot;, e);</span><br><span class="line">        message = &quot;网络异常，请稍后再试!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response.put(&quot;success&quot;, success);</span><br><span class="line">    response.put(&quot;message&quot;, message);</span><br><span class="line">    return response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>也就是要返回一个Map, 并带有success和message参数。</p><h2 id="解析markdown内容"><a href="#解析markdown内容" class="headerlink" title="解析markdown内容"></a>解析markdown内容</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;#--markdown2html--&gt;</span><br><span class="line">&lt;#macro md2html content&gt;</span><br><span class="line">    &lt;#local uuid=func(&apos;uuid&apos;, &apos;id&apos;)/&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;$&#123;ctx&#125;/libs/editor.md/css/editormd.preview.css&quot;/&gt;</span><br><span class="line">&lt;div id=&quot;$&#123;uuid&#125;&quot; class=&quot;markdown-content&quot;&gt;</span><br><span class="line">    &lt;textarea style=&quot;display: none&quot;&gt;$&#123;content&#125;&lt;/textarea&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;$&#123;ctx&#125;/libs/editor.md//lib/marked.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;$&#123;ctx&#125;/libs/editor.md//lib/prettify.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;$&#123;ctx&#125;/libs/editor.md//lib/raphael.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;$&#123;ctx&#125;/libs/editor.md//lib/underscore.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;$&#123;ctx&#125;/libs/editor.md//lib/sequence-diagram.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;$&#123;ctx&#125;/libs/editor.md//lib/flowchart.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;$&#123;ctx&#125;/libs/editor.md//lib/jquery.flowchart.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;$&#123;ctx&#125;/libs/editor.md/editormd.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    $(function () &#123;</span><br><span class="line">        editormd.markdownToHTML(&quot;$&#123;uuid&#125;&quot;, &#123;</span><br><span class="line">            path: &quot;$&#123;ctx&#125;/libs/editor.md/lib/&quot;,</span><br><span class="line">            htmlDecode: &quot;style,script,iframe&quot;,  // you can filter tags decode</span><br><span class="line">            emoji: true,</span><br><span class="line">            taskList: true,</span><br><span class="line">            tex: true,  // 默认不解析</span><br><span class="line">            flowChart: true,  // 默认不解析</span><br><span class="line">            sequenceDiagram: true  // 默认不解析</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure><p>用例：&lt;@ca.md2html content=”${article.content}”/&gt;</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;markdown编辑器&quot;&gt;&lt;a href=&quot;#markdown编辑器&quot; class=&quot;headerlink&quot; title=&quot;markdown编辑器&quot;&gt;&lt;/a&gt;markdown编辑器&lt;/h2&gt;&lt;p&gt;下面是使用freemarker定义的宏，是一个markdown编辑器。&lt;/p&gt;
    
    </summary>
    
      <category term="Web前端" scheme="http://kangyonggan.com/categories/Web%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>js实现上拉加载更多</title>
    <link href="http://kangyonggan.com/2019/01/08/js%E5%AE%9E%E7%8E%B0%E4%B8%8A%E6%8B%89%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A/"/>
    <id>http://kangyonggan.com/2019/01/08/js实现上拉加载更多/</id>
    <published>2019-01-08T06:31:07.000Z</published>
    <updated>2019-01-08T06:36:12.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 获取滚动条的位置</span><br><span class="line"> *</span><br><span class="line"> * @returns &#123;number&#125;</span><br><span class="line"> */</span><br><span class="line">function getScrollTop() &#123;</span><br><span class="line">    var scrollTop = 0;</span><br><span class="line">    if (document.documentElement &amp;&amp; document.documentElement.scrollTop) &#123;</span><br><span class="line">        scrollTop = document.documentElement.scrollTop;</span><br><span class="line">    &#125; else if (document.body) &#123;</span><br><span class="line">        scrollTop = document.body.scrollTop;</span><br><span class="line">    &#125;</span><br><span class="line">    return scrollTop;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 获取当前可视范围的高度</span><br><span class="line"> *</span><br><span class="line"> * @returns &#123;number&#125;</span><br><span class="line"> */</span><br><span class="line">function getClientHeight() &#123;</span><br><span class="line">    var clientHeight = 0;</span><br><span class="line">    if (document.body.clientHeight &amp;&amp; document.documentElement.clientHeight) &#123;</span><br><span class="line">        clientHeight = Math.min(document.body.clientHeight, document.documentElement.clientHeight);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        clientHeight = Math.max(document.body.clientHeight, document.documentElement.clientHeight);</span><br><span class="line">    &#125;</span><br><span class="line">    return clientHeight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 获取文档完整的高度</span><br><span class="line"> *</span><br><span class="line"> * @returns &#123;number&#125;</span><br><span class="line"> */</span><br><span class="line">function getScrollHeight() &#123;</span><br><span class="line">    return Math.max(document.body.scrollHeight, document.documentElement.scrollHeight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 是否还有更多内容</span><br><span class="line"> */</span><br><span class="line">var hasMore = true;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 上拉加载更多事件</span><br><span class="line"> */</span><br><span class="line">window.onscroll = function () &#123;</span><br><span class="line">    if (hasMore &amp;&amp; getScrollTop() + getClientHeight() === getScrollHeight()) &#123;</span><br><span class="line">        console.log(&quot;加载更多...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>当没有更多内容时，把hasMore置为false，否则会一直去尝试加载更多</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
      <category term="Web前端" scheme="http://kangyonggan.com/categories/Web%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>js返回上一页的实现</title>
    <link href="http://kangyonggan.com/2019/01/08/js%E8%BF%94%E5%9B%9E%E4%B8%8A%E4%B8%80%E9%A1%B5%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
    <id>http://kangyonggan.com/2019/01/08/js返回上一页的实现/</id>
    <published>2019-01-08T06:29:10.000Z</published>
    <updated>2019-01-08T06:30:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>如果有上一页则返回上一页，如果没上一页（直接输入url打开的网页）则返回首页。兼容主流浏览器。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 返回</span><br><span class="line"> */</span><br><span class="line">function goBack() &#123;</span><br><span class="line">    if ((navigator.userAgent.indexOf(&apos;MSIE&apos;) &gt;= 0) &amp;&amp; (navigator.userAgent.indexOf(&apos;Opera&apos;) &lt; 0)) &#123;</span><br><span class="line">        // IE</span><br><span class="line">        if (history.length &gt; 0) &#123;</span><br><span class="line">            window.history.go(-1);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            window.location.href = ctx + &quot;/&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 非IE浏览器</span><br><span class="line">        if (navigator.userAgent.indexOf(&apos;Firefox&apos;) &gt;= 0 ||</span><br><span class="line">            navigator.userAgent.indexOf(&apos;Opera&apos;) &gt;= 0 ||</span><br><span class="line">            navigator.userAgent.indexOf(&apos;Safari&apos;) &gt;= 0 ||</span><br><span class="line">            navigator.userAgent.indexOf(&apos;Chrome&apos;) &gt;= 0 ||</span><br><span class="line">            navigator.userAgent.indexOf(&apos;WebKit&apos;) &gt;= 0) &#123;</span><br><span class="line"></span><br><span class="line">            if (window.history.length &gt; 1) &#123;</span><br><span class="line">                window.history.go(-1);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                window.location.href = ctx + &quot;/&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 未知的浏览器</span><br><span class="line">            window.history.go(-1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;如果有上一页则返回上一页，如果没上一页（直接输入url打开的网页）则返回首页。兼容主流浏览器。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;
      
    
    </summary>
    
      <category term="Web前端" scheme="http://kangyonggan.com/categories/Web%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>js检测浏览器是PC端还是手机端</title>
    <link href="http://kangyonggan.com/2019/01/08/js%E6%A3%80%E6%B5%8B%E6%B5%8F%E8%A7%88%E5%99%A8%E6%98%AFPC%E7%AB%AF%E8%BF%98%E6%98%AF%E6%89%8B%E6%9C%BA%E7%AB%AF/"/>
    <id>http://kangyonggan.com/2019/01/08/js检测浏览器是PC端还是手机端/</id>
    <published>2019-01-08T06:23:14.000Z</published>
    <updated>2019-01-08T06:27:27.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function IsPC() &#123;</span><br><span class="line">    var userAgentInfo = navigator.userAgent;</span><br><span class="line">    var Agents = [&quot;Android&quot;, &quot;iPhone&quot;,</span><br><span class="line">        &quot;SymbianOS&quot;, &quot;Windows Phone&quot;,</span><br><span class="line">        &quot;iPad&quot;, &quot;iPod&quot;];</span><br><span class="line">    var flag = true;</span><br><span class="line">    for (var v = 0; v &lt; Agents.length; v++) &#123;</span><br><span class="line">        if (userAgentInfo.indexOf(Agents[v]) &gt; 0) &#123;</span><br><span class="line">            flag = false;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//true为PC端，false为手机端</span><br><span class="line">var flag = IsPC();</span><br><span class="line">if (!flag) &#123;</span><br><span class="line">    window.location.href = &quot;$&#123;ctx&#125;/wap&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
      <category term="Web前端" scheme="http://kangyonggan.com/categories/Web%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
</feed>
